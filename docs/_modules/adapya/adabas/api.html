

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>adapya.adabas.api &mdash; adapya-adabas 1.0.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/SAG2015.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> adapya-adabas
          

          
            
            <img src="../../../_static/SAG2015.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installing.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../users_guide.html">Userâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Package Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../indices.html">Indices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">adapya-adabas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>adapya.adabas.api</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for adapya.adabas.api</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: latin1 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">adapya.adabas.api - Adabas Programming Interface</span>
<span class="sd">================================================</span>

<span class="sd">The adapya.adabas.api module defines the Adabas and Adabasx classes which implement</span>
<span class="sd">the Adabas API.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>          <span class="c1"># PY3</span>

<span class="n">__date__</span><span class="o">=</span><span class="s1">&#39;$Date: 2019-11-21 15:21:10 +0100 (Thu, 21 Nov 2019) $&#39;</span>
<span class="n">__revision__</span><span class="o">=</span><span class="s1">&#39;$Rev: 949 $&#39;</span>

<span class="kn">import</span> <span class="nn">getpass</span> <span class="c1"># for getuser()</span>
<span class="kn">import</span> <span class="nn">os</span>      <span class="c1"># for getpid()</span>
<span class="kn">import</span> <span class="nn">socket</span>  <span class="c1"># for gethostname()</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">from</span> <span class="nn">ctypes</span> <span class="k">import</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">,</span> <span class="n">sizeof</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># import adapya.base</span>
<span class="kn">from</span> <span class="nn">adapya.base</span> <span class="k">import</span> <span class="n">defs</span> <span class="c1"># for variables dummymutex,logopt,logstr</span>
<span class="kn">from</span> <span class="nn">adapya.base.defs</span> <span class="k">import</span> <span class="n">Abuf</span><span class="p">,</span><span class="n">adalog</span>
<span class="kn">from</span> <span class="nn">adapya.base.defs</span> <span class="k">import</span> <span class="n">LOGCMD</span><span class="p">,</span><span class="n">LOGBEFORE</span><span class="p">,</span><span class="n">LOGCB</span><span class="p">,</span><span class="n">LOGFB</span><span class="p">,</span><span class="n">LOGRB</span><span class="p">,</span><span class="n">LOGSB</span><span class="p">,</span><span class="n">LOGVB</span>
<span class="kn">from</span> <span class="nn">adapya.base.defs</span> <span class="k">import</span> <span class="n">LOGIB</span><span class="p">,</span><span class="n">LOGMB</span><span class="p">,</span><span class="n">LOGPB</span><span class="p">,</span><span class="n">LOGUB</span><span class="p">,</span><span class="n">LOGRSP</span><span class="p">,</span><span class="n">LOGBUF</span><span class="p">,</span><span class="n">LOGSP</span>
<span class="kn">from</span> <span class="nn">adapya.base.conv</span> <span class="k">import</span> <span class="n">str2ebc</span>
<span class="kn">from</span> <span class="nn">adapya.base.datamap</span> <span class="k">import</span> <span class="n">Datamap</span><span class="p">,</span> <span class="n">Uint1</span><span class="p">,</span> <span class="n">Uint2</span><span class="p">,</span> <span class="n">Uint4</span><span class="p">,</span> <span class="n">Uint8</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> \
    <span class="n">Char</span><span class="p">,</span> <span class="n">Int2</span><span class="p">,</span> <span class="n">Int4</span><span class="p">,</span> <span class="n">Bytes</span><span class="p">,</span> <span class="n">T_STCK</span><span class="p">,</span> <span class="n">T_GMT</span><span class="p">,</span> <span class="n">T_HEX</span><span class="p">,</span> <span class="n">T_NWBO</span><span class="p">,</span> <span class="n">T_EBCDIC</span><span class="p">,</span> \
    <span class="n">fpack</span><span class="p">,</span> <span class="n">NATIVEBO</span><span class="p">,</span> <span class="n">NETWORKBO</span>
<span class="kn">from</span> <span class="nn">adapya.base.dump</span> <span class="k">import</span> <span class="n">dump</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">adaerror</span>

<span class="c1"># fix Python2 difference: make iterator&#39;s next() methods available</span>
<span class="c1"># as next() function -- copied from six</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">advance_iterator</span> <span class="o">=</span> <span class="nb">next</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">advance_iterator</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="nb">next</span> <span class="o">=</span> <span class="n">advance_iterator</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;win32&#39;</span><span class="p">,</span><span class="s1">&#39;cli&#39;</span><span class="p">):</span> <span class="c1"># CPython or IronPython</span>
    <span class="n">adalname</span> <span class="o">=</span> <span class="s1">&#39;adalnkx&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">adalname</span> <span class="o">=</span> <span class="s1">&#39;libadalnkx.so&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">adalink</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">cdll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="n">adalname</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running Python Version </span><span class="si">%s</span><span class="se">\n\t</span><span class="s1">on platform </span><span class="si">%s</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> bit, byteorder=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
         <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">c_char_p</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; could not be loaded: check that Adabas Client Library (ACL) directory is in path&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">adalname</span><span class="p">,))</span>
    <span class="k">raise</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s1">&#39;zos&#39;</span><span class="p">:</span>
    <span class="n">adalink</span><span class="o">.</span><span class="n">AdaSetParameter</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">]</span>
    <span class="n">adalink</span><span class="o">.</span><span class="n">AdaSetTimeout</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span><span class="n">c_int</span><span class="p">]</span>
    <span class="n">adalink</span><span class="o">.</span><span class="n">adabas</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">]</span>
    <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_set_adabas_id</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">]</span>
    <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_set_uid_pw</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_int</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">,</span><span class="n">c_char_p</span><span class="p">]</span>     <span class="c1"># acl V6.5 used for LUW Adabas databases only</span>

<span class="k">def</span> <span class="nf">adaSetTimeout</span><span class="p">(</span> <span class="n">sec</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;zos&#39;</span><span class="p">:</span>     <span class="c1"># function not available on zos</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># set Adabas timeout value in Adalnk</span>
        <span class="k">return</span> <span class="n">adalink</span><span class="o">.</span><span class="n">AdaSetTimeout</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">adaSetParameter</span><span class="p">(</span> <span class="n">parm</span><span class="p">):</span>
    <span class="c1"># set parameter in Adalnk</span>
    <span class="k">return</span> <span class="n">adalink</span><span class="o">.</span><span class="n">AdaSetParameter</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>


<span class="n">HOBF</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># High-order-byte first big-endian</span>
<span class="n">LOBF</span><span class="o">=</span><span class="mi">2</span>  <span class="c1"># low-order-byte first little-endian</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;big&#39;</span><span class="p">:</span>
    <span class="n">nativeByteOrder</span><span class="o">=</span><span class="n">HOBF</span>
    <span class="n">UNICODE_INTERNAL</span><span class="o">=</span><span class="s1">&#39;utf_16_be&#39;</span>
<span class="k">else</span><span class="p">:</span>   <span class="c1"># little</span>
    <span class="n">nativeByteOrder</span><span class="o">=</span><span class="n">LOBF</span>
    <span class="n">UNICODE_INTERNAL</span><span class="o">=</span><span class="s1">&#39;utf_16_le&#39;</span>


<span class="c1"># Adabas file access modes</span>
<span class="n">ACC</span><span class="o">=</span><span class="mi">0</span>
<span class="n">UPD</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ONL</span><span class="o">=</span><span class="mi">2</span>
<span class="n">EXU</span><span class="o">=</span><span class="mi">3</span>
<span class="n">EXF</span><span class="o">=</span><span class="mi">4</span>

<span class="n">PRV</span><span class="o">=</span><span class="mi">1</span>

<span class="n">open_modes</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;ACC&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;UPD&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ONL&#39;</span><span class="p">,</span> <span class="n">PRV</span><span class="p">),</span>
              <span class="p">(</span><span class="s1">&#39;EXU&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;EXF&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="Warning"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Warning">[docs]</a><span class="k">class</span> <span class="nc">Warning</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="NotYetImplementedError"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.NotYetImplementedError">[docs]</a><span class="k">class</span> <span class="nc">NotYetImplementedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="ProgrammingError"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.ProgrammingError">[docs]</a><span class="k">class</span> <span class="nc">ProgrammingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="InvalidSearchString"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.InvalidSearchString">[docs]</a><span class="k">class</span> <span class="nc">InvalidSearchString</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>  <span class="c1"># used in Adabas.search()</span></div>


<span class="c1"># AdabasException class introduced for Python 3.0 support</span>
<div class="viewcode-block" id="AdabasException"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.AdabasException">[docs]</a><span class="k">class</span> <span class="nc">AdabasException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instance will have set the following values:</span>

<span class="sd">    self.value  is the Adabas response string</span>

<span class="sd">    self.apa    is the Adabas call parameters that were used when</span>
<span class="sd">                the error occurred</span>

<span class="sd">    Example on how to call it::</span>

<span class="sd">        if subclassed e.g. with class DatabaseError(AdabasException)</span>

<span class="sd">        try:</span>
<span class="sd">            raise AdabasException(value,apa)</span>
<span class="sd">        except AdabasException as e:</span>
<span class="sd">            adalog.warning(&#39;AdabasException&#39;, e.value, e.__class__)</span>
<span class="sd">            dump(e.apa.acb,log=adalog.warning)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">apa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apa</span> <span class="o">=</span> <span class="n">apa</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<span class="c1"># class DatabaseError(Exception): pass     # Adabas Response</span>
<span class="c1"># class DataEnd(Exception): pass           # Adabas Response Code 3 EOF</span>
<span class="c1"># class InterfaceError(Exception): pass    # passed only one string value</span>
<span class="c1">#</span>
<span class="c1"># for Python 3.0 changed to</span>
<span class="c1">#</span>
<div class="viewcode-block" id="DatabaseError"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.DatabaseError">[docs]</a><span class="k">class</span> <span class="nc">DatabaseError</span><span class="p">(</span><span class="n">AdabasException</span><span class="p">):</span> <span class="k">pass</span> <span class="c1"># Adabas Response other than 0 or 3</span></div>
<div class="viewcode-block" id="DataEnd"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.DataEnd">[docs]</a><span class="k">class</span> <span class="nc">DataEnd</span><span class="p">(</span><span class="n">AdabasException</span><span class="p">):</span> <span class="k">pass</span>       <span class="c1"># Adabas Response Code 3 EOF</span></div>

<span class="c1"># Adalinkx Interface Error</span>
<div class="viewcode-block" id="InterfaceError"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.InterfaceError">[docs]</a><span class="k">class</span> <span class="nc">InterfaceError</span><span class="p">(</span><span class="n">AdabasException</span><span class="p">):</span> <span class="k">pass</span> <span class="c1"># passes call parameters</span></div>

<span class="c1"># not used yet: needs classification of response code (adaresp)</span>
<span class="c1"># class InternalError(DatabaseError): pass</span>
<span class="c1"># class OperationalError(DatabaseError): pass</span>
<span class="c1"># class IntegrityError(DatabaseError): pass</span>
<span class="c1"># class DataError(DatabaseError): pass</span>
<span class="c1"># class NotSupportedError(DatabaseError): pass</span>

<span class="c1">#</span>
<span class="c1"># Acb - classic Adabas control block</span>
<span class="c1">#</span>
<span class="n">ACBLEN</span> <span class="o">=</span> <span class="mh">0x50</span>

<div class="viewcode-block" id="Acb"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Acb">[docs]</a><span class="k">class</span> <span class="nc">Acb</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">(</span>
            <span class="n">Uint1</span><span class="p">(</span>  <span class="s1">&#39;typ&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;rsv1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;cid&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span> <span class="s1">&#39;cidn&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">4</span><span class="p">),</span>    <span class="c1">## redefines cid numeric</span>
            <span class="n">Int2</span><span class="p">(</span>  <span class="s1">&#39;fnr&#39;</span><span class="p">),</span>              <span class="c1">## changed from Uint2 for INFOBUFFER V8.2</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;rsp&#39;</span><span class="p">),</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;dbid&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>  <span class="c1">## redefines rsp</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;isn&#39;</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;isl&#39;</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;isq&#39;</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;fbl&#39;</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;rbl&#39;</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;sbl&#39;</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;vbl&#39;</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;ibl&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad1&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;ad2&#39;</span><span class="p">),</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;lcmp&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">4</span><span class="p">),</span> <span class="c1">## redefines ad2</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;ldec&#39;</span><span class="p">),</span>            <span class="c1">##</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad3&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad4&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad5&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;cmdt&#39;</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;usr&#39;</span><span class="p">),</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;pdbid&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">4</span><span class="p">),</span> <span class="c1">## redefines usr</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;pnucid&#39;</span><span class="p">)</span>           <span class="c1">##</span>
            <span class="p">)</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Acb&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c1"># reset ACB fields if buffer was given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">cb</span><span class="o">=</span><span class="bp">self</span>         <span class="c1"># shorthand</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">cid</span><span class="o">=</span><span class="s1">&#39;    &#39;</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">fnr</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="o">=</span><span class="mi">0</span>      <span class="c1"># return</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="mi">0</span>      <span class="c1"># return</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">=</span><span class="mi">0</span>      <span class="c1"># return</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">=</span><span class="mi">0</span>      <span class="c1"># return</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">fbl</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">rbl</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">sbl</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">vbl</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ibl</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad2</span><span class="o">=</span><span class="mi">0</span>    <span class="c1"># return if response code</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad3</span><span class="o">=</span><span class="s1">&#39; &#39;</span>  <span class="c1"># password</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="s1">&#39; &#39;</span>  <span class="c1"># cipher code</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad5</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">cmdt</span><span class="o">=</span><span class="mi">0</span>
            <span class="c1"># cb.usr=0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">pdbid</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">pnucid</span><span class="o">=</span><span class="mi">0</span></div>

<span class="c1">#</span>
<span class="c1"># acbx - extended Adabas control block</span>
<span class="c1">#</span>
<span class="n">ACBXV2</span>  <span class="o">=</span> <span class="s1">&#39;F2&#39;</span>  <span class="c1"># Type ADACBX, Version 2</span>
<span class="n">ACBXLEN</span> <span class="o">=</span> <span class="mh">0xC0</span>

<div class="viewcode-block" id="Acbx"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Acbx">[docs]</a><span class="k">class</span> <span class="nc">Acbx</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">(</span>
            <span class="n">Uint1</span><span class="p">(</span>  <span class="s1">&#39;typ&#39;</span><span class="p">),</span>
            <span class="n">Char</span><span class="p">(</span>   <span class="s1">&#39;rsv1&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;len&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;nid&#39;</span><span class="p">),</span>   <span class="c1">## no network byte order</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;rsp&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;cid&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span>   <span class="s1">&#39;cidn&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">4</span><span class="p">),</span>    <span class="c1">## redefines cid numeric</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;dbid&#39;</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span>  <span class="s1">&#39;fnr&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;isn&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;isl&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;isq&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op3&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op4&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op5&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op6&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op7&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op8&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;op1_8&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad1&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;ad2&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad3&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad4&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad5&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ad6&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;rsv3&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;erra&#39;</span><span class="p">),</span>       <span class="c1"># x68 error offset in buffer</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;errb&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>    <span class="c1"># x70 Field name or offset</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;errbb&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span>

            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;errc&#39;</span><span class="p">),</span>       <span class="c1"># x72 Subcode</span>
            <span class="n">Char</span><span class="p">(</span>   <span class="s1">&#39;errd&#39;</span><span class="p">),</span>       <span class="c1"># x74 Buffer type</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;erre&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>    <span class="c1"># x75</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;errf&#39;</span><span class="p">),</span>       <span class="c1"># Buffer number</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;subr&#39;</span><span class="p">),</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;subs&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;subt&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;lcmp&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;ldec&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;cmdt&#39;</span><span class="p">),</span>    <span class="c1"># command time in 1/4096 micro sec units</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;usr&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;rsv4&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;pdbid&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=-</span><span class="p">(</span><span class="mi">16</span><span class="o">+</span><span class="mi">24</span><span class="p">),</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_NWBO</span><span class="p">),</span> <span class="c1">## redefines usr ## network byte order *Temp*</span>
            <span class="n">Uint2</span><span class="p">(</span>  <span class="s1">&#39;pnucid&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_NWBO</span><span class="p">)</span>                 <span class="c1">## network byte order *Temp*</span>
            <span class="p">)</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Acbx&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<span class="c1"># abdx - Extended Adabas Buffer Descriptor</span>

<span class="n">ABDXL</span>   <span class="o">=</span> <span class="mi">48</span>
<span class="n">ABDXV2</span>  <span class="o">=</span> <span class="s1">&#39;G2&#39;</span>  <span class="c1"># Type ADABDX, Version 2</span>
<span class="c1"># Values for abdx.loc</span>
<span class="n">ABDXSTD</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>   <span class="c1"># buffer at end of ABDX (standard)</span>
<span class="n">ABDXIND</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span>   <span class="c1"># Indirectly addressed</span>
<span class="c1"># Values for abdx.id</span>
<span class="n">ABDXF</span>   <span class="o">=</span> <span class="s1">&#39;F&#39;</span>   <span class="c1"># Format buffer</span>
<span class="n">ABDXR</span>   <span class="o">=</span> <span class="s1">&#39;R&#39;</span>   <span class="c1"># Record buffer</span>
<span class="n">ABDXM</span>   <span class="o">=</span> <span class="s1">&#39;M&#39;</span>   <span class="c1"># Multifetch buffer</span>
<span class="n">ABDXS</span>   <span class="o">=</span> <span class="s1">&#39;S&#39;</span>   <span class="c1"># Search buffer</span>
<span class="n">ABDXV</span>   <span class="o">=</span> <span class="s1">&#39;V&#39;</span>   <span class="c1"># Value buffer</span>
<span class="n">ABDXI</span>   <span class="o">=</span> <span class="s1">&#39;I&#39;</span>   <span class="c1"># ISN buffer</span>
<span class="n">ABDXP</span>   <span class="o">=</span> <span class="s1">&#39;P&#39;</span>   <span class="c1"># Performance buffer</span>
<span class="n">ABDXU</span>   <span class="o">=</span> <span class="s1">&#39;U&#39;</span>   <span class="c1"># User buffer</span>


<div class="viewcode-block" id="Abdx"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Abdx">[docs]</a><span class="k">class</span> <span class="nc">Abdx</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">abdx32_fields</span><span class="o">=</span><span class="p">(</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;len&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;rsv1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;rsv2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span>   <span class="s1">&#39;rsv3&#39;</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span>   <span class="s1">&#39;rsv4&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;size&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;send&#39;</span><span class="p">),</span>    <span class="c1"># send size</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;recv&#39;</span><span class="p">),</span>    <span class="c1"># receive size</span>
            <span class="n">Int4</span><span class="p">(</span>   <span class="s1">&#39;rsv5&#39;</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;addr&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">abdx64_fields</span><span class="o">=</span><span class="p">(</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;len&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;rsv1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Bytes</span><span class="p">(</span>  <span class="s1">&#39;rsv2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span>   <span class="s1">&#39;rsv3&#39;</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span>   <span class="s1">&#39;rsv4&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;size&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;send&#39;</span><span class="p">),</span>    <span class="c1"># send size</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;recv&#39;</span><span class="p">),</span>    <span class="c1"># receive size</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;addr&#39;</span><span class="p">)</span>     <span class="c1"># 64 bit addresses</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">8</span><span class="p">:</span> <span class="c1"># 64 bit addresses</span>
            <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abdx&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">abdx64_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abdx&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">abdx32_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<span class="n">ADAID_SL2</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1"># adaid structure level w/o timestamp</span>
<span class="n">ADAID_SL3</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># adaid structure level with timestamp</span>
<span class="n">ADAIDL</span>    <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># size of adaid structure changed from 24, sl3 fits all</span>

<div class="viewcode-block" id="Adaid"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adaid">[docs]</a><span class="k">class</span> <span class="nc">Adaid</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Adaid&#39;</span><span class="p">,</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;level&#39;</span><span class="p">),</span>
            <span class="n">Int2</span><span class="p">(</span>   <span class="s1">&#39;size&#39;</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">Uint4</span><span class="p">(</span>  <span class="s1">&#39;pid&#39;</span><span class="p">),</span>
            <span class="n">Uint8</span><span class="p">(</span>  <span class="s1">&#39;timestamp&#39;</span><span class="p">),</span>   <span class="c1"># set at open call</span>
            <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Adasafinfo"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adasafinfo">[docs]</a><span class="k">class</span> <span class="nc">Adasafinfo</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Adasafinfo&#39;</span><span class="p">,</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;userid&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">String</span><span class="p">(</span> <span class="s1">&#39;newpassword&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>
<span class="n">ADASAFINFOL</span><span class="o">=</span><span class="mi">24</span> <span class="c1"># 8+2*100  # 24</span>
<span class="n">ADASAFX</span> <span class="o">=</span> <span class="mh">0xd8</span>


<div class="viewcode-block" id="Mcbuh"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Mcbuh">[docs]</a><span class="k">class</span> <span class="nc">Mcbuh</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Multicall Buffer Header with offsets to global or array of elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;MulticallBufferHeader&#39;</span><span class="p">,</span>
            <span class="n">Int2</span><span class="p">(</span><span class="s1">&#39;goff&#39;</span><span class="p">),</span>   <span class="c1"># offset of global area</span>
            <span class="n">Int2</span><span class="p">(</span><span class="s1">&#39;moff&#39;</span><span class="p">),</span>   <span class="c1"># offset of multiple areas in one buffer</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buffer</span><span class="p">:</span>     <span class="c1"># reset fields if underlying buffer exists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moff</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Mcstoff"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Mcstoff">[docs]</a><span class="k">class</span> <span class="nc">Mcstoff</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Multicall Buffer set up start offset array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;MCBufferStartOffsetArray&#39;</span><span class="p">,</span>
            <span class="n">Int2</span><span class="p">(</span><span class="s1">&#39;offs&#39;</span><span class="p">,</span><span class="n">occurs</span><span class="o">=</span><span class="n">nc</span><span class="p">),</span>   <span class="c1"># start offset array</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buffer</span><span class="p">:</span>     <span class="c1"># reset fields if underlying buffer exists</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># reset offsets initially</span></div>
            <span class="c1">#o mc update first unused byte in buffer</span>

<div class="viewcode-block" id="Mfhdr"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Mfhdr">[docs]</a><span class="k">class</span> <span class="nc">Mfhdr</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;MultifetchHeader&#39;</span><span class="p">,</span>
            <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;elecount&#39;</span><span class="p">),</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mfele"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Mfele">[docs]</a><span class="k">class</span> <span class="nc">Mfele</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;MultifetchElement&#39;</span><span class="p">,</span>
            <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;reclen&#39;</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;rsp&#39;</span><span class="p">),</span>
            <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;isn&#39;</span><span class="p">),</span> <span class="c1"># PE Index for L9</span>
            <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;isq&#39;</span><span class="p">),</span> <span class="c1"># Number of index values for L9</span>
            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span></div>

<span class="c1"># Adabas open command architecture bits - different from Network architecture bits!!!</span>
<span class="c1"># These bits indicate how the application wants to send/receive  the data</span>
<span class="n">AOCBSW</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># Byte swap</span>
<span class="n">AOCEBC</span> <span class="o">=</span> <span class="mi">2</span>    <span class="c1"># EBCDIC</span>
<span class="n">AOCVAX</span> <span class="o">=</span> <span class="mi">4</span>    <span class="c1"># VAX floating point</span>
<span class="n">AOCI3E</span> <span class="o">=</span> <span class="mi">8</span>    <span class="c1"># IEEE floating point</span>

<span class="c1"># Network Architecture bits returned in ISL after OP-command</span>
<span class="c1"># = self.dbarchit</span>
<span class="n">RDAABSW</span> <span class="o">=</span><span class="mh">0x01</span>    <span class="c1"># Byte swap</span>
<span class="n">RDAAEBC</span> <span class="o">=</span><span class="mh">0x04</span>    <span class="c1"># EBCDIC</span>
<span class="n">RDAASC8</span> <span class="o">=</span><span class="mh">0x08</span>    <span class="c1"># ASCII8</span>
<span class="n">RDAAFVAX</span><span class="o">=</span><span class="mh">0x10</span>    <span class="c1"># VAX floating point</span>
<span class="n">RDAAFI3E</span><span class="o">=</span><span class="mh">0x20</span>    <span class="c1"># IEEE floating point</span>

<span class="k">def</span> <span class="nf">archit2str</span><span class="p">(</span><span class="n">arc</span><span class="p">):</span>
    <span class="n">a1</span><span class="o">=</span><span class="s1">&#39;High-order-byte-first&#39;</span>
    <span class="n">a2</span><span class="o">=</span><span class="s1">&#39;ASCII&#39;</span>
    <span class="n">a3</span><span class="o">=</span><span class="s1">&#39;IBM-float&#39;</span>
    <span class="k">if</span> <span class="n">arc</span> <span class="o">&amp;</span> <span class="n">RDAABSW</span><span class="p">:</span>
        <span class="n">a1</span><span class="o">=</span><span class="s1">&#39;Low-order-byte-first&#39;</span>
    <span class="k">if</span> <span class="n">arc</span> <span class="o">&amp;</span> <span class="n">RDAAEBC</span><span class="p">:</span>
        <span class="n">a2</span><span class="o">=</span><span class="s1">&#39;EBCDIC&#39;</span>
    <span class="k">if</span> <span class="n">arc</span> <span class="o">&amp;</span> <span class="n">RDAAFVAX</span><span class="p">:</span>
        <span class="n">a3</span><span class="o">=</span><span class="s1">&#39;VAX-float&#39;</span>
    <span class="k">if</span> <span class="n">arc</span> <span class="o">&amp;</span> <span class="n">RDAAFI3E</span><span class="p">:</span>
        <span class="n">a3</span><span class="o">=</span><span class="s1">&#39;IEEE-float&#39;</span>
    <span class="k">return</span> <span class="n">a1</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">a2</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">a3</span>

<div class="viewcode-block" id="setsaf"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.setsaf">[docs]</a><span class="k">def</span> <span class="nf">setsaf</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="n">newpass</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">encrypter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set session userid and password with ADASAF databases.</span>

<span class="sd">    :param userid: user id for security system where database resides</span>
<span class="sd">    :param password: security system password</span>
<span class="sd">    :param encrypter: optional call back routine that encrypts</span>
<span class="sd">                      logon data matching installation-defined decryption</span>
<span class="sd">                      in remote database</span>

<span class="sd">    The data is used in the Adalnk for login to a</span>
<span class="sd">    protected database request userid and password.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">safib</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ADASAFINFOL</span><span class="p">)</span>
    <span class="n">safi</span> <span class="o">=</span> <span class="n">Adasafinfo</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="n">safib</span><span class="p">)</span>
    <span class="n">safi</span><span class="o">.</span><span class="n">userid</span><span class="o">=</span><span class="n">userid</span>     <span class="c1">#</span>
    <span class="n">safi</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">password</span> <span class="c1">#</span>
    <span class="c1"># leave at \x00 as set from Abuf()</span>
    <span class="k">if</span> <span class="n">newpass</span><span class="p">:</span>
        <span class="n">safi</span><span class="o">.</span><span class="n">newpassword</span><span class="o">=</span><span class="n">newpass</span>

    <span class="k">if</span> <span class="n">encrypter</span><span class="p">:</span>
        <span class="n">encrypter</span><span class="p">(</span><span class="n">safib</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="mi">16</span> <span class="c1"># 108</span>
        <span class="k">if</span> <span class="n">newpass</span><span class="p">:</span>
            <span class="n">ii</span><span class="o">+=</span><span class="mi">8</span> <span class="c1"># 100</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03010100</span><span class="p">:</span>
            <span class="c1"># PY2.7 ctypes.c_char needs string -&gt; chr()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">):</span>
                <span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">ADASAFX</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">):</span>
                <span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">ADASAFX</span>

    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="n">dump</span><span class="p">(</span><span class="n">safib</span><span class="p">,</span><span class="s1">&#39;safib&#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">AdaSetSaf</span><span class="p">(</span><span class="n">safib</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">i</span></div>

<div class="viewcode-block" id="cbyte"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.cbyte">[docs]</a><span class="k">def</span> <span class="nf">cbyte</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="s2">&quot;condense key string to one byte&quot;</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mh">0xff</span></div>


<div class="viewcode-block" id="setuidpw"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.setuidpw">[docs]</a><span class="k">def</span> <span class="nf">setuidpw</span><span class="p">(</span><span class="n">dbid</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">encrypter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set session userid and password with LUW databases.</span>
<span class="sd">       Starting with LUW Adabas 6.5</span>

<span class="sd">    :param dbid: database id to which userid and password apply</span>
<span class="sd">    :param userid: user id for security system where database resides</span>
<span class="sd">    :param password: security system password</span>
<span class="sd">    :param encrypter: optional call back routine that encrypts</span>
<span class="sd">                      logon data matching installation-defined decryption</span>
<span class="sd">                      in remote database</span>

<span class="sd">    The data is used in the Adalnk for login to a</span>
<span class="sd">    protected database request userid and password.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">safuid</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">safpw</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">safuid</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span>
    <span class="n">safpw</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="c1"># leave at \x00 as set from Abuf()</span>
    <span class="c1"># otherwise taken as newpassword function:</span>
    <span class="c1"># safi.newpassword=&#39;&#39;</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">encrypter</span><span class="p">:</span>
        <span class="n">encrypter</span><span class="p">(</span><span class="n">safib</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03010100</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="c1"># PY2 ctypes.c_char needs string -&gt; chr()</span>
                <span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">ADASAFX</span><span class="p">)</span>
                <span class="n">safib</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">safib</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">ADASAFX</span><span class="p">)</span>
                <span class="c1"># newpassword not used in this function:</span>
                <span class="c1"># safib[16+i] = chr(ord(safib[16+i])^ADASAFX)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">safib</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">ADASAFX</span>
                <span class="n">safib</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">safib</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="n">i</span><span class="p">])</span><span class="o">^</span><span class="n">ADASAFX</span>
                <span class="c1"># newpassword not used in this function:</span>
                <span class="c1"># safib[16+i] = ord(safib[16+i])^ADASAFX</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_set_uid_pw</span><span class="p">(</span><span class="n">dbid</span><span class="p">,</span> <span class="n">safuid</span><span class="p">,</span> <span class="n">safpw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">i</span></div>

<div class="viewcode-block" id="s1"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.s1">[docs]</a><span class="k">def</span> <span class="nf">s1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return string s after 1 byte inclusive length</span>

<span class="sd">    :param s: input string</span>
<span class="sd">    :param byteorder: byteorder for input unicode string may be &#39;&lt;&#39; little or &#39;&gt;&#39; big endian</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">in</span> <span class="s1">&#39;&gt;!&#39;</span><span class="p">:</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="s1">&#39;UTF_16BE&#39;</span>
    <span class="k">elif</span> <span class="n">byteorder</span><span class="o">==</span><span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="s1">&#39;UTF_16LE&#39;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># byteorder in &#39;@=&#39;</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="n">UNICODE_INTERNAL</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03010100</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enco</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enco</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Cannot wrap </span><span class="si">%s</span><span class="s2"> in s1(), need type of str, bytes or bytearray&quot;</span><span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">),))</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;Length of string is </span><span class="si">%d</span><span class="s1"> for s1(), exceeds 254 bytes&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">s</span></div>

<div class="viewcode-block" id="s2"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.s2">[docs]</a><span class="k">def</span> <span class="nf">s2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return string s after 2 bytes inclusive length</span>
<span class="sd">       byteorder may be &#39;&lt;&#39; little or &#39;&gt;&#39; big endian</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">in</span> <span class="s1">&#39;&gt;!&#39;</span><span class="p">:</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="s1">&#39;UTF_16BE&#39;</span>
    <span class="k">elif</span> <span class="n">byteorder</span><span class="o">==</span><span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="s1">&#39;UTF_16LE&#39;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># byteorder in &#39;@=&#39;</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="n">UNICODE_INTERNAL</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03010100</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enco</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enco</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Cannot wrap </span><span class="si">%s</span><span class="s2"> in s4(), need type of str, bytes or bytearray&quot;</span><span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">),))</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16382</span><span class="p">,</span> <span class="s1">&#39;Length of string is </span><span class="si">%d</span><span class="s1"> for s1(), exceeds 16381 bytes&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">H&#39;</span><span class="o">%</span><span class="n">byteorder</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">s</span></div>

<div class="viewcode-block" id="s4"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.s4">[docs]</a><span class="k">def</span> <span class="nf">s4</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">):</span>
    <span class="s2">&quot;return string s after 4 bytes inclusive length&quot;</span>
    <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">in</span> <span class="s1">&#39;&gt;!&#39;</span><span class="p">:</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="s1">&#39;UTF_16BE&#39;</span>
    <span class="k">elif</span> <span class="n">byteorder</span><span class="o">==</span><span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="s1">&#39;UTF_16LE&#39;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># byteorder in &#39;@=&#39;</span>
        <span class="n">enco</span> <span class="o">=</span> <span class="n">UNICODE_INTERNAL</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03010100</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enco</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enco</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Cannot wrap </span><span class="si">%s</span><span class="s2"> in s4(), need type of str, bytes or bytearray&quot;</span><span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">),))</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">l&#39;</span><span class="o">%</span><span class="n">byteorder</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">s</span></div>

<div class="viewcode-block" id="sl4"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.sl4">[docs]</a><span class="k">def</span> <span class="nf">sl4</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">):</span>
    <span class="s2">&quot;return string with packed length of string. Used for AAL elements&quot;</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">&lt;</span> <span class="mh">0x03010100</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Cannot wrap </span><span class="si">%s</span><span class="s2"> in s4(), need type of str, bytes or bytearray&quot;</span><span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">),))</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">l&#39;</span><span class="o">%</span><span class="n">byteorder</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">size</span><span class="p">)</span></div>

<span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Adabas"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas">[docs]</a><span class="k">class</span> <span class="nc">Adabas</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the data structures and methods for Adabas database access.</span>

<span class="sd">    These are the Adabas control block and buffers for the</span>
<span class="sd">    Adabas call() and high level methods for the Adabas API</span>

<span class="sd">    :param fbl: format buffer length - fb will be allocated of that size</span>
<span class="sd">    :param rbl: record buffer length - rb will be allocated of that size</span>
<span class="sd">    :param sbl: search buffer length - sb will be allocated of that size</span>
<span class="sd">    :param vbl: value buffer length - vb will be allocated of that size</span>
<span class="sd">    :param ibl: ISN buffer length - ib will be allocated of that size</span>


<span class="sd">    &gt;&gt;&gt; from adapya.adabas.api import *</span>
<span class="sd">    &gt;&gt;&gt; a=Adabas(fbl=12,rbl=100) # create control block, format and record buffer</span>
<span class="sd">    &gt;&gt;&gt; a.cb.dbid=8              # set database id</span>
<span class="sd">    &gt;&gt;&gt; a.cb.fnr=11              # set file number</span>
<span class="sd">    &gt;&gt;&gt; a.fb.value=&#39;AA,AB.&#39;      # select interesting fields</span>
<span class="sd">    &gt;&gt;&gt; a.getiseq()              # get ISN in sequence (I option)</span>
<span class="sd">    &gt;&gt;&gt; print(a.rb.value)</span>
<span class="sd">    50005500ALEXANDRE           BRAUN</span>

<span class="sd">    See the __init__() method for parameter details of creating an</span>
<span class="sd">    instance of the Adabas class.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Adabas.newbuffer"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.newbuffer">[docs]</a>    <span class="k">def</span> <span class="nf">newbuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resize or define new buffer of &lt;type&gt; in ACB style</span>
<span class="sd">        if current size &gt; size: old buffer will be reused</span>

<span class="sd">        :param type:  one of (&#39;F&#39;,&#39;R&#39;,&#39;S&#39;,&#39;V&#39;,&#39;I&#39;)</span>
<span class="sd">        :param size:  if &gt; 0: allocate buffer and set it for</span>
<span class="sd">                for further reference in call parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">fbl</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">fbl</span> <span class="o">=</span> <span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fb</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">rbl</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">rbl</span> <span class="o">=</span> <span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rb</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">sbl</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">sbl</span> <span class="o">=</span> <span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">vbl</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">vbl</span> <span class="o">=</span> <span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">ibl</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ibl</span> <span class="o">=</span> <span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ib</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Invalid Adabas call buffer type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ibl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pmutex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">thread</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">multifetch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">archit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cipher</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">totalCalls</span>
        <span class="n">gg</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;totalCalls&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">:</span> <span class="n">totalCalls</span><span class="o">=</span><span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span> <span class="o">=</span> <span class="n">pmutex</span> <span class="k">if</span> <span class="n">pmutex</span> <span class="k">else</span> <span class="n">defs</span><span class="o">.</span><span class="n">dummymutex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cidseq</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># automatic cid count (should be user related)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>             <span class="c1"># cipher code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_responses</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of response/subcode tuples consumed on each call()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>             <span class="c1"># number of updates in transaction (store,delete,update)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span> <span class="o">=</span> <span class="n">archit</span>        <span class="c1"># architecture of adabas buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bo</span> <span class="o">=</span> <span class="n">NATIVEBO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;latin1&#39;</span>     <span class="c1"># default buffer encoding unless architecture is EBCDIC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbarchit</span> <span class="o">=</span> <span class="kc">None</span>         <span class="c1"># archit returned from database OP call</span>



        <span class="k">if</span> <span class="n">archit</span> <span class="ow">and</span> <span class="p">(</span><span class="n">archit</span> <span class="o">&amp;</span> <span class="n">RDAAEBC</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">archit</span> <span class="o">&amp;</span> <span class="n">RDAABSW</span><span class="p">):</span>
            <span class="c1"># mainframe native calls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bo</span> <span class="o">=</span> <span class="n">NETWORKBO</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;cp037&#39;</span> <span class="c1"># EBCDIC US (Latin1 characterset)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span> <span class="o">=</span> <span class="n">RDAAEBC</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">archit</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;zos&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;cp037&#39;</span> <span class="c1"># EBCDIC US (Latin1 characterset)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span> <span class="o">=</span> <span class="n">RDAAEBC</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acb</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">ACBLEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">=</span><span class="n">Acb</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acb</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>

        <span class="n">cb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span>      <span class="c1"># shorthand</span>

        <span class="c1"># Acb fields are formatted in Acb() initialization since buffer was given</span>
        <span class="c1"># set fields specific to Adabas initialization</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="mh">0x30</span> <span class="c1"># X30 call</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="mh">0x30</span> <span class="c1"># X30 call</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">fbl</span><span class="o">=</span><span class="n">fbl</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">rbl</span><span class="o">=</span><span class="n">rbl</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">sbl</span><span class="o">=</span><span class="n">sbl</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">vbl</span><span class="o">=</span><span class="n">vbl</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ibl</span><span class="o">=</span><span class="n">ibl</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fb</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">fbl</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">if</span> <span class="n">fbl</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">rbl</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">if</span> <span class="n">rbl</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">sbl</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">if</span> <span class="n">sbl</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">vbl</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">if</span> <span class="n">vbl</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ib</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">ibl</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">if</span> <span class="n">ibl</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># set after open(), if &gt;0: assigned cluster nucid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># generator set if multifetch</span>

        <span class="k">if</span> <span class="n">multifetch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">=</span><span class="n">multifetch</span>  <span class="c1"># number of records to fetch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">=</span><span class="n">Mfele</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfhdr</span><span class="o">=</span><span class="n">Mfhdr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">=</span><span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setadaid</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

<div class="viewcode-block" id="Adabas.call"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">cbfields</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; issue Call Adabas with the Adabas control block class variables</span>

<span class="sd">            :param cbfields: list of key value pairs that can be used to</span>
<span class="sd">                set the control block before the call</span>

<span class="sd">            &gt;&gt;&gt; c1.call(cmd=&#39;L1&#39;, cid=&#39;ABCD&#39;, fnr=11, isn=12345)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">totalCalls</span>
        <span class="n">cb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cbfields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">cb</span><span class="o">.</span><span class="n">dbid</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">dbid</span>           <span class="c1"># remember dbid if not yet done</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="ow">and</span> <span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;AELNS&#39;</span><span class="p">):</span> <span class="c1"># set pwd for read and upd commands</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span> <span class="ow">and</span> <span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;AELNS&#39;</span><span class="p">):</span> <span class="c1"># set cipher code for read and upd commands</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cipher</span>

        <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="mh">0x04</span><span class="p">:</span> <span class="c1"># physical call (default is 0x30)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">cb</span><span class="o">.</span><span class="n">pnucid</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">pnucid</span>           <span class="c1"># remember dbid if not yet done</span>

            <span class="n">cb</span><span class="o">.</span><span class="n">pdbid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbid</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">pnucid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nucid</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="o">=</span><span class="mi">0</span>    <span class="c1">#o cb.dbid=0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="mh">0x30</span>  <span class="c1"># logical call (reset after call adaOS6.1)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">dbid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbid</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">pdbid</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">pnucid</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_set_adabas_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="n">LOGBEFORE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logapa</span><span class="p">(</span><span class="s1">&#39;Before Adabas call&#39;</span><span class="p">,</span><span class="n">before</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># issue call</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">adabas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">totalCalls</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InterfaceError</span><span class="p">(</span><span class="s1">&#39;Adabas call interface returned: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># prepare subcode data and error texts</span>
            <span class="c1"># or set compressed reclen / reclen</span>
            <span class="k">if</span> <span class="n">nativeByteOrder</span><span class="o">==</span><span class="n">HOBF</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sub1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad2</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad2</span><span class="o">&amp;</span><span class="mh">0xFFFF</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad2</span><span class="o">&gt;&gt;</span><span class="mi">16</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sub1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad2</span><span class="o">&amp;</span><span class="mh">0xFFFF</span>

            <span class="n">errtext</span><span class="o">=</span><span class="n">adaerror</span><span class="o">.</span><span class="n">rsptext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span><span class="p">,</span>
                <span class="n">cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">subcmd1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="p">,</span> <span class="n">subcmd2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="p">),</span>

        <span class="c1"># print(&#39;logopt: %04X, logstr: %s&#39; % (defs.logopt, defs.logstr))  # test</span>
        <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGCMD</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGRSP</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">64</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;CL&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logapa</span><span class="p">(</span><span class="s1">&#39;After Adabas call&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_responses</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_responses</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">xrsp</span><span class="p">,</span><span class="n">xsub</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xrsp</span><span class="p">,</span> <span class="n">xsub</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># just a response code (with no subcode specified)</span>

            <span class="k">if</span> <span class="n">xsub</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1"># only response code specified</span>
                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGCMD</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
                        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Checking for expected response </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">xrsp</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">xrsp</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> \
                    <span class="s1">&#39;Unexpected response </span><span class="si">%d</span><span class="s1">, expected response </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> <span class="n">xrsp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGCMD</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
                        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Checking for expected response </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xrsp</span><span class="p">,</span><span class="n">xsub</span><span class="p">))</span>
                <span class="k">assert</span> <span class="n">xrsp</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="ow">and</span> <span class="n">xsub</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span><span class="p">,</span> \
                    <span class="s1">&#39;Unexpected response </span><span class="si">%d</span><span class="s1">/subcode </span><span class="si">%d</span><span class="s1">, expected response </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span><span class="p">,</span> <span class="n">xrsp</span><span class="p">,</span> <span class="n">xsub</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># ignore DE truncation warning</span>
            <span class="c1"># self.cb.rsp = 0</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="n">DataEnd</span><span class="p">(</span><span class="s2">&quot;End of Data&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">64</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;CL&#39;</span><span class="p">):</span>
            <span class="c1"># do not raise if CL and rsp=64</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="n">errtext</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Adabas.logapa"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.logapa">[docs]</a>    <span class="k">def</span> <span class="nf">logapa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loghdr</span><span class="p">,</span><span class="n">before</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Logging of Adabas call parameters for Acb</span>

<span class="sd">            Options set in logopt determine which buffer to log</span>

<span class="sd">            :param before: set to true if logging before the adabas call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
            <span class="n">rsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span>
            <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="p">(</span><span class="n">LOGCB</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rsp</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">before</span><span class="p">):</span>
                <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">loghdr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showCB</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="n">before</span><span class="p">)</span>
                <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acb</span><span class="p">,</span> <span class="s1">&#39;Control Block &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acb</span><span class="p">),</span> <span class="s1">&#39;CB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">LOGCB</span><span class="o">|</span><span class="n">LOGBEFORE</span><span class="p">):</span> <span class="c1"># any buffer logging at all?</span>
                <span class="n">lopt</span> <span class="o">=</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">LOGCB</span><span class="o">|</span><span class="n">LOGBEFORE</span><span class="o">|</span><span class="n">LOGBUF</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="n">LOGBUF</span><span class="p">:</span> <span class="c1"># log buffers depending on command</span>
                    <span class="n">bf</span><span class="p">,</span> <span class="n">bfa</span> <span class="o">=</span> <span class="n">cmdbufs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
                        <span class="n">lopt</span> <span class="o">|=</span> <span class="n">bf</span>  <span class="c1"># OR any direct log request with eligible buffers depending on command</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lopt</span> <span class="o">|=</span> <span class="n">bfa</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGBEFORE</span> <span class="k">else</span> <span class="n">bf</span><span class="p">)</span>
                        <span class="c1"># include buffers sent to Adabas (were not logged before)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">lopt</span> <span class="o">&amp;</span> <span class="n">LOGFB</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">fbl</span><span class="p">:</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb</span><span class="p">,</span> <span class="s1">&#39;Format Buffer &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb</span><span class="p">),</span> <span class="s1">&#39;FB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lopt</span> <span class="o">&amp;</span> <span class="n">LOGRB</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rbl</span><span class="p">:</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">,</span> <span class="s1">&#39;Record Buffer &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">),</span> <span class="s1">&#39;RB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lopt</span> <span class="o">&amp;</span> <span class="n">LOGSB</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">sbl</span><span class="p">:</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="p">,</span> <span class="s1">&#39;Search Buffer&#39;</span><span class="p">,</span> <span class="s1">&#39;SB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lopt</span> <span class="o">&amp;</span> <span class="n">LOGVB</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">vbl</span><span class="p">:</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="p">,</span> <span class="s1">&#39;Value Buffer&#39;</span><span class="p">,</span> <span class="s1">&#39;VB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lopt</span> <span class="o">&amp;</span> <span class="n">LOGIB</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ibl</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib</span><span class="p">,</span> <span class="s1">&#39;ISN Buffer&#39;</span><span class="p">,</span> <span class="s1">&#39;IB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span></div>

<div class="viewcode-block" id="Adabas.multifetch"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.multifetch">[docs]</a>    <span class="k">def</span> <span class="nf">multifetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generator function</span>
<span class="sd">            :param dmap: datamap of record buffer - offset will be advanced</span>

<span class="sd">            :returns: tuple (ISN, datamap)</span>

<span class="sd">            Note: currently with ACB or ACBX with one RB/MB pair</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isn</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">ad3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad3</span>  <span class="c1"># keep additions3 for repetitive call()</span>
        <span class="n">ad4</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span>  <span class="c1"># keep additions4 for repetitive call()</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

            <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span> <span class="o">!=</span><span class="s1">&#39;M&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span>
                <span class="k">continue</span>    <span class="c1"># no multifetch running</span>

            <span class="c1"># initialize mulitifetch buffers</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Adabasx</span><span class="p">):</span>
                <span class="n">mb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mb</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ib</span>      <span class="c1"># with ACB use ISN buffer</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mfhdr</span><span class="o">.</span><span class="n">buffer</span><span class="o">=</span><span class="n">mb</span>

            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfhdr</span><span class="o">.</span><span class="n">elecount</span>

            <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataEnd</span><span class="p">(</span><span class="s2">&quot;End of Data in multifetch()&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">buffer</span><span class="o">=</span><span class="n">mb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">offset</span><span class="o">=</span><span class="mi">4</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataEnd</span><span class="p">(</span><span class="s2">&quot;End of Data&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">rsp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># any other response - no subcode provided in mfele</span>
                    <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                      <span class="n">adaerror</span><span class="o">.</span><span class="n">rsptext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># rsp == 0</span>
                    <span class="n">recl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">reclen</span>
                    <span class="n">isn</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">isn</span>
                    <span class="k">if</span> <span class="n">recl</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DataEnd</span><span class="p">(</span><span class="s2">&quot;End of Data&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">isn</span><span class="p">,</span> <span class="n">recl</span>      <span class="c1"># return ISN and current record length</span>
                        <span class="c1">#####</span>
                        <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span><span class="o">+=</span><span class="n">recl</span>    <span class="c1"># advance in record buffer</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">.</span><span class="n">offset</span><span class="o">+=</span><span class="mi">16</span> <span class="c1"># advance in ISN buffer</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mfhdr</span><span class="o">.</span><span class="n">elecount</span><span class="o">=</span><span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>          <span class="c1"># Read in ISN sequence</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span><span class="o">+</span><span class="mi">1</span>           <span class="c1"># next ISN</span>
            <span class="n">isn</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad3</span><span class="o">=</span><span class="n">ad3</span>                 <span class="c1"># Restore any Additions3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="n">ad4</span>                 <span class="c1"># Restore any Additions4</span></div>

    <span class="c1"># end of multifetch()</span>

<div class="viewcode-block" id="Adabas.multicall"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.multicall">[docs]</a>    <span class="k">def</span> <span class="nf">multicall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nc</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Multi-call after Acb and buffers have been allocated</span>

<span class="sd">        :param nc: number of commands</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;MC&#39;</span>    <span class="c1"># Multi Call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">=</span><span class="n">nc</span>      <span class="c1"># number of commands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbs</span><span class="o">=</span><span class="p">[]</span>         <span class="c1"># array of Acbs in one multicall buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fboffs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rboffs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbsoffs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbsoffs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibsoffs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fblu</span><span class="o">=</span><span class="mi">0</span>         <span class="c1"># number of bytes used in buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rblu</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sblu</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vblu</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iblu</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fbuh</span><span class="o">=</span><span class="kc">None</span>      <span class="c1"># buffer header structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rbuh</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbuh</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbuh</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibuh</span><span class="o">=</span><span class="kc">None</span>

        <span class="c1"># each buffer starts with a MC command buffer header with 2 short</span>
        <span class="c1"># integers (datamap Mcbuh):</span>
        <span class="c1"># - offset within buffer to global part used by all subcommands</span>
        <span class="c1"># - offset to array of (short integer) offsets to start of individual</span>
        <span class="c1">#   parts one for each subcommand</span>
        <span class="c1"># for the record buffer the array of Adabas control blocks for the</span>
        <span class="c1"># number of subcommands follow</span>

        <span class="k">if</span> <span class="n">nc</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>            <span class="c1"># set up multiple Acbs within record buffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rbuh</span><span class="o">=</span><span class="n">Mcbuh</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rblu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rbuh</span><span class="o">.</span><span class="n">dmlen</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Acb</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rblu</span><span class="p">,</span>
                                <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span>
                                <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rblu</span> <span class="o">+=</span> <span class="n">ACBLEN</span>             <span class="c1"># updated used length of rb</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rblu</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rbl</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s1">&#39;Buffer length exceeded (multi-call)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span></div>
        <span class="c1">#o set up array of start offsets</span>

<div class="viewcode-block" id="Adabas.setoffs"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.setoffs">[docs]</a>    <span class="k">def</span> <span class="nf">setoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btyp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set start offsets within Multi-Call buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>



<div class="viewcode-block" id="Adabas.setadaid"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.setadaid">[docs]</a>    <span class="k">def</span> <span class="nf">setadaid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">adaidlev</span><span class="o">=</span><span class="n">ADAID_SL3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set Adabas communication id</span>
<span class="sd">        This method is called during intialization of Adabas/Adabasx object</span>
<span class="sd">        only if thread is not zero.</span>

<span class="sd">        :param thread: thread number</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">=</span><span class="n">thread</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">ADAIDL</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;zos&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">=</span><span class="n">Adaid</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="n">NETWORKBO</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">=</span><span class="n">Adaid</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">level</span><span class="o">=</span><span class="n">adaidlev</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">ADAIDL</span>

        <span class="k">if</span> <span class="n">thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">node</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># under mod_python getpass.getuser() cannot import pwd</span>
                <span class="c1"># set user from signon?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">user</span><span class="o">=</span><span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>             <span class="c1"># identification</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;unkown&#39;</span>

            <span class="n">_pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
            <span class="c1">#if _pid &gt; 0x7fff:</span>
            <span class="c1">#    _pid -= 0x10000  # make negative</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">_pid</span><span class="o">&amp;</span><span class="mh">0xffff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">thread</span>     <span class="c1"># pid is integer</span>

            <span class="c1"># print(&#39;node=%s, user=%s, pid=%s&#39; % \</span>
            <span class="c1">#   (self.adaid.node, self.adaid.user, self.adaid.pid))</span>
            <span class="c1">##c = Abuf(ADAIDL)</span>
            <span class="c1">##adalink.lnk_get_adabas_id(ADAIDL,c);dump(c,&#39;Adaid Original&#39;)</span>
            <span class="c1">#### i = adapy.setuser(self.node, self.user, self.pid)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_set_adabas_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_get_adabas_id</span><span class="p">(</span><span class="n">ADAIDL</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="p">)</span></div>

        <span class="c1"># self.adaid.dprint()</span>
        <span class="c1"># dump(self.aidb,&#39;Adaid after setting&#39;)</span>

<div class="viewcode-block" id="Adabas.setcb"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.setcb">[docs]</a>    <span class="k">def</span> <span class="nf">setcb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">cbfields</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set Adabas control block class variables in one call</span>

<span class="sd">            cbfields = list of key value pairs that can be used to</span>
<span class="sd">            set the control block</span>

<span class="sd">            &gt;&gt;&gt; c1.setcb(cmd=&#39;L1&#39;, cid=&#39;ABCD&#39;, fnr=11, isn=12345)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cbfields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="Adabas.showCB"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.showCB">[docs]</a>    <span class="k">def</span> <span class="nf">showCB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print Adabas control block interpreted</span>

<span class="sd">        :param before: if not zero show CB fields relevant for before</span>
<span class="sd">                       the adabas call (e.g. no response code, cmd time)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="c1"># Acb(buffer=self.acb)</span>
        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cmd=</span><span class="si">%s</span><span class="s1"> op1/2=</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> ad1=</span><span class="si">%s</span><span class="s1"> dbid=</span><span class="si">%d</span><span class="s1"> fnr=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">fnr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cmd=</span><span class="si">%s</span><span class="s1"> op1/2=</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> ad1=</span><span class="si">%s</span><span class="s1"> dbid=</span><span class="si">%d</span><span class="s1"> fnr=</span><span class="si">%d</span><span class="s1"> cmdt=</span><span class="si">%6.3f</span><span class="s1"> ms rsp=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span><span class="p">,</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">fnr</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">cmdt</span><span class="o">*</span><span class="mf">16.</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">))</span>
        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cid=</span><span class="si">%d</span><span class="s1"> isn=</span><span class="si">%d</span><span class="s1"> isl=</span><span class="si">%d</span><span class="s1"> isq=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">cidn</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="p">))</span>
        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fbl=</span><span class="si">%d</span><span class="s1">, rbl=</span><span class="si">%d</span><span class="s1">, sbl=</span><span class="si">%d</span><span class="s1">, vbl=</span><span class="si">%d</span><span class="s1">, ibl=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
          <span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">fbl</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">rbl</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">sbl</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">vbl</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">ibl</span><span class="p">))</span>
        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;ad3=</span><span class="si">%s</span><span class="s1">, ad4=</span><span class="si">%s</span><span class="s1">, ad5=</span><span class="si">%s</span><span class="s1">, pdbid=</span><span class="si">%d</span><span class="s1">, pnucid=</span><span class="si">%d</span><span class="s1">, pid=</span><span class="si">%04X</span><span class="s1">&#39;</span> <span class="o">%</span> \
          <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ad3</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">ad5</span><span class="p">),</span> <span class="n">cb</span><span class="o">.</span><span class="n">pdbid</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">pnucid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span></div>


<div class="viewcode-block" id="Adabas.open"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tnaa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">etid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">arc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wcode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">wcharset</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a user session with a database.</span>

<span class="sd">        :var self.cb.dbid: must be set before calling this function</span>

<span class="sd">        :param acode: ECS code page number for client data encoding of A fields</span>

<span class="sd">        :param arc: architecture key is the sum of the following values</span>
<span class="sd">                      - 1: low order byte first, default: high order byte first</span>
<span class="sd">                      - 2: EBCDIC, default: ASCII</span>
<span class="sd">                      - 4: VAX floating-point</span>
<span class="sd">                      - 8: IEEE floating-point, default: IBM 370 float</span>
<span class="sd">                      - default: arc=0 will use data format native to caller&#39;s machine</span>

<span class="sd">        :param etid: 8 bytes Adabas transaction user id</span>

<span class="sd">        :param mode:</span>
<span class="sd">            defines share mode of files, default None</span>
<span class="sd">            if mode is a string it may be a list of modes e.g. &#39;UPD=2,ACC=3&#39;</span>

<span class="sd">        :param tnaa:</span>
<span class="sd">            time of non-activity</span>

<span class="sd">        :param tt:</span>
<span class="sd">            transaction time</span>

<span class="sd">        :param tz:</span>
<span class="sd">            Timezone name according to the Olson Timezone DB / pytz</span>
<span class="sd">            e.g. &#39;Europe/Paris&#39;</span>

<span class="sd">        :param wcode: ECS code page number for client data encoding of W fields</span>

<span class="sd">        :param wcharset: IANA name for W field encoding (ADABAS OpenSystems V5.1,</span>
<span class="sd">            Mainframe V7.4 only recognizes &#39;UTF-8&#39; for other encodings use wcode)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;OP&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">=</span><span class="n">tnaa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">=</span><span class="n">tt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>         <span class="c1"># option R restrict files</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span> <span class="o">!=</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>     <span class="c1"># leave option E read ET data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">etid</span>

        <span class="n">_l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">open_modes</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># set open mode RB=UPD=.</span>
        <span class="k">if</span> <span class="n">arc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ARC=&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">arc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">acode</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ACODE=&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">acode</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wcode</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;WCODE=&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">wcode</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wcharset</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WCHARSET=&#39;&quot;</span><span class="o">+</span><span class="n">wcharset</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tz</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TZ=&#39;&quot;</span><span class="o">+</span><span class="n">tz</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="n">_rb</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_l</span><span class="p">)</span>  <span class="c1"># make string with parts separated by comma</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">_rb</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span> <span class="c1"># Adabas call</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># reset number of updates</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hexversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">&gt;&gt;</span><span class="mi">24</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">&gt;&gt;</span><span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">&gt;&gt;</span><span class="mi">8</span>  <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span>     <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="nb">str</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">smlevel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ptlevel</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dbarchit</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">&gt;&gt;</span><span class="mi">24</span>      <span class="c1">#</span>
                                              <span class="c1">#        0  1   2           4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opsys</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">&gt;&gt;</span><span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="c1"># opsys=(Mf,VMS,OpenSystems,NPR)</span>
                                              <span class="c1"># OpenSystems = Unix, Windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">&amp;</span> <span class="mh">0xffff</span>    <span class="c1"># nucid &gt; 0 if cluster nucleus</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># reset isl and isq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">=</span><span class="mi">0</span></div>

<div class="viewcode-block" id="Adabas.nextcid"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.nextcid">[docs]</a>    <span class="k">def</span> <span class="nf">nextcid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns integer of next CID value for sequence operations</span>
<span class="sd">           (obsolete: use cidn=-1 to let Adabas automatically return)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cidseq</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cidseq</span></div>


<div class="viewcode-block" id="Adabas.checkpoint1"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.checkpoint1">[docs]</a>    <span class="k">def</span> <span class="nf">checkpoint1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;UCP1&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write Checkpoint.</span>

<span class="sd">        :param flush: = 1 to start a bufferflush</span>
<span class="sd">        :param id: checkpoint id as 4 byte characterstring</span>
<span class="sd">        :var self.cb.dbid: must be set before calling this function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">str2ebc</span><span class="p">(</span><span class="nb">id</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flush</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


<div class="viewcode-block" id="Adabas.checkpoint5"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.checkpoint5">[docs]</a>    <span class="k">def</span> <span class="nf">checkpoint5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write User Checkpoint with data.</span>

<span class="sd">        :var self.cb.dbid: must be set before calling this function</span>
<span class="sd">        :var self.rb: The record buffer may hold checkpoint data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;C5&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_call_with_etdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">etdata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function to set &lt;etdata&gt; into record buffer</span>
<span class="sd">           in Adabas() or Adabasx() record buffers, adjust lengths</span>
<span class="sd">           and issue the Adabas call.</span>

<span class="sd">           With etdata == &#39;&#39; the E option is set too in order to write</span>
<span class="sd">           Session counters to ET record (with CL command)</span>

<span class="sd">           Called from: et() and close()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># keep buffer size</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Adabasx</span><span class="p">):</span>
            <span class="n">rbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rabd</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rbl</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">rbl</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="s1">&#39;Length of etdata </span><span class="si">%d</span><span class="s1"> exceeds record buffer length </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">),</span><span class="n">rbl</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="s1">&#39;Length of etdata </span><span class="si">%d</span><span class="s1"> exceeds 2000&#39;</span> <span class="o">%</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;E&#39;</span> <span class="c1"># option E read/write ET data</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">etdata</span>

        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Adabasx</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rabd</span><span class="o">.</span><span class="n">send</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rbl</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">etdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rbl</span><span class="o">=</span><span class="n">rbl</span>  <span class="c1"># restore rbl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>      <span class="c1"># reset E option</span>

<div class="viewcode-block" id="Adabas.close"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etdata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close user session with database</span>

<span class="sd">        :param etdata: (optional) ET data to write with end of transaction</span>
<span class="sd">                       requires *etid* being set with :meth:`Adabas.open`</span>

<span class="sd">        :var self.cb.dbid: must be set before calling this function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;CL&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>

        <span class="k">if</span> <span class="n">etdata</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_with_etdata</span><span class="p">(</span><span class="n">etdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># reset number of updates</span></div>


<div class="viewcode-block" id="Adabas.et"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.et">[docs]</a>    <span class="k">def</span> <span class="nf">et</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">etdata</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;End Transaction with database.</span>

<span class="sd">        :param etdata: (optional) ET data to write with end of transaction</span>
<span class="sd">            requires *etid* being set with :meth:`Adabas.open`</span>

<span class="sd">        :var self.cb.dbid: must be set before calling this function</span>

<span class="sd">        .. note:: currently does not support Multifetch option</span>

<span class="sd">        Function supports both Adabas and Adabasx calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;ET&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="c1">#self.cb.op3=&#39;H&#39; # set option H to keep shared hold</span>

        <span class="k">if</span> <span class="n">etdata</span><span class="p">:</span>  <span class="c1"># E option not set if etdata empty (unlike CL cmd)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_with_etdata</span><span class="p">(</span><span class="n">etdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># reset number of updates</span></div>


<div class="viewcode-block" id="Adabas.bt"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.bt">[docs]</a>    <span class="k">def</span> <span class="nf">bt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Backout Transaction with database</span>
<span class="sd">        dbid - must be set before calling this function</span>
<span class="sd">        Note: not ET-data supported, no Multifetch option</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;BT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span> <span class="c1"># option E read ET data</span>
        <span class="c1">#self.cb.op3=&#39;H&#39; # set option H to keep shared hold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># reset number of updates</span></div>


<div class="viewcode-block" id="Adabas.find"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">saveisn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find records by selection</span>

<span class="sd">        :param saveisn: 1 saves ISNs on WORK for later processing under CID</span>

<span class="sd">        :param sort: &#39;FNF2F3&#39; may specify up to 3 descriptors by which the</span>
<span class="sd">                      selected records are sorted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;S1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span> <span class="c1"># release ISN list for CID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">saveisn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">sort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;S2&#39;</span>
        <span class="c1">#if &#39;acb&#39; in dir(self):</span>
        <span class="c1">#    self.cb.ibl=0           # don&#39;t read first record (old acb)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


<div class="viewcode-block" id="Adabas.first_unused"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.first_unused">[docs]</a>    <span class="k">def</span> <span class="nf">first_unused</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fnr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return first unused ISN from FCB</span>
<span class="sd">            This number can be used as an upper bound to the number of</span>
<span class="sd">            records loaded. Do not use this function on an expanded file.</span>

<span class="sd">            :returns: first unused ISN</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;F&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
        <span class="k">if</span> <span class="n">dbid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">dbid</span><span class="o">=</span><span class="n">dbid</span>
        <span class="k">if</span> <span class="n">fnr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">fnr</span><span class="o">=</span><span class="n">fnr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span></div>


<div class="viewcode-block" id="Adabas.get"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get record with ISN=isn</span>

<span class="sd">        if hold is true: put record in hold (L4)</span>

<span class="sd">        if wait is true: wait if record is in hold</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
        <span class="k">if</span> <span class="n">isn</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


<div class="viewcode-block" id="Adabas.getiseq"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.getiseq">[docs]</a>    <span class="k">def</span> <span class="nf">getiseq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get record with ISN in ISN sequence</span>

<span class="sd">        if hold is true: put record in hold (L4)</span>

<span class="sd">        if wait is true: wait if record is in hold</span>

<span class="sd">        if dmap set to a datamap and multifetch is set to &gt; 1  in</span>
<span class="sd">        the Adabas class getiseq() returns the size of the record</span>
<span class="sd">        that is located in the datamap buffer at the offset</span>

<span class="sd">        returns tuple (ISN, record_length)</span>

<span class="sd">        Example with multifetch:</span>

<span class="sd">        &gt;&gt;&gt; while c.getiseq(dmap=emp):</span>
<span class="sd">        ...    emp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">dmap</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># multifetch</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>             <span class="c1"># first call</span>
                <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
                    <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;M&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;O&#39;</span>      <span class="c1"># M+R combined</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
                <span class="k">if</span> <span class="n">isn</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multifetch</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
                <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
            <span class="k">if</span> <span class="n">isn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">+=</span><span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rbl</span>  <span class="c1"># rbl is &gt; 0</span></div>


<div class="viewcode-block" id="Adabas.getnext"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.getnext">[docs]</a>    <span class="k">def</span> <span class="nf">getnext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get next record from ISN list after find()</span>

<span class="sd">        if hold is true: put record in hold (L4)</span>

<span class="sd">        if wait is true: wait if record is in hold</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;N&#39;</span>

        <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


<div class="viewcode-block" id="Adabas.histo"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.histo">[docs]</a>    <span class="k">def</span> <span class="nf">histo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descriptor</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read Index by descriptor (deprecated)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>       <span class="c1"># could be &#39;M&#39; for multifetch</span>

        <span class="k">if</span> <span class="n">descriptor</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">descriptor</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">6</span>

        <span class="k">if</span> <span class="n">descending</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;D&#39;</span>   <span class="c1"># descending</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>   <span class="c1"># ascending &#39;A&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="mi">0</span>         <span class="c1"># reset ISN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L9&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>

<div class="viewcode-block" id="Adabas.histogram"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.histogram">[docs]</a>    <span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Histogram sequence generator</span>

<span class="sd">        :param seq: histogram descriptor, e.g. seq=&#39;AA&#39;</span>
<span class="sd">        :param descending: read descending if true</span>
<span class="sd">            (only with seq=&#39;descriptor&#39; sequence)</span>
<span class="sd">        :param dmap: Datamap object</span>

<span class="sd">        :return:  (value, quantity, lowest_ISN, PE_occurrcence)</span>

<span class="sd">          datamap object if *dmap* set to a Datamap and</span>
<span class="sd">          multifetch is set to &gt; 1 in the Adabas class.</span>
<span class="sd">          The function returns the Datamap object</span>
<span class="sd">          that is located in the datamap buffer at the offset.</span>
<span class="sd">          It can be printed with .lprint() (line) or .dprint() (detail)</span>

<span class="sd">        Example with datamap:</span>

<span class="sd">        &gt;&gt;&gt; for isn, xemp in c.histogram(seq=&#39;AE&#39;, dmap=emp):</span>
<span class="sd">        ...    xemp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        Example without datamap:</span>

<span class="sd">        &gt;&gt;&gt; emp.buffer = c.rb</span>
<span class="sd">        &gt;&gt;&gt; for isn, _ in c.histogram(seq=&#39;AE&#39;):</span>
<span class="sd">        ...     emp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dmap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L9&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cidn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># may not work (global cid counter in api.py?)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># +&#39; &#39;*6</span>
        <span class="k">if</span> <span class="n">descending</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>   <span class="c1"># descending</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>   <span class="c1"># ascending</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">dmap</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># multifetch</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>          <span class="c1"># first call</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;M&#39;</span>
                <span class="n">mfgen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multifetch</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">isn</span><span class="p">,</span> <span class="n">rlen</span><span class="p">,</span> <span class="n">isq</span> <span class="o">=</span> <span class="n">mfgen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                    <span class="k">yield</span> <span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span><span class="p">,</span> <span class="n">isq</span>
                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># returns with StopIteration</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># no multifetch</span>
            <span class="c1"># preserve for repeating calls</span>
            <span class="c1"># ad3 = self.cb.ad3</span>
            <span class="n">ad4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">dmap</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span>

                    <span class="c1"># self.cb.ad3=ad3  # restore for next call</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="n">ad4</span>

                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># returns with StopIteration</span></div>






<div class="viewcode-block" id="Adabas.hold"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.hold">[docs]</a>    <span class="k">def</span> <span class="nf">hold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Put record in hold with ISN=isn</span>
<span class="sd">        (prevent other users from updating the record)</span>

<span class="sd">        if wait is true: wait if record is in hold</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;HI&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span> <span class="c1"># Return if record in hold</span>
        <span class="k">if</span> <span class="n">isn</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>

<div class="viewcode-block" id="Adabas.insert"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fastde</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;Alias for store()&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span><span class="p">,</span> <span class="n">fastde</span><span class="o">=</span><span class="n">fastde</span><span class="p">)</span></div>

<div class="viewcode-block" id="Adabas.getopsys"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.getopsys">[docs]</a>    <span class="k">def</span> <span class="nf">getopsys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return Operating System and Adabas Version</span>

<span class="sd">        Adabas open() call must have been done before</span>

<span class="sd">        :return: string containing Opesys and Adabas version of</span>
<span class="sd">                database nucleus</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; c1.Adabas()</span>
<span class="sd">        &gt;&gt;&gt; c1.cb.db=10025</span>
<span class="sd">        &gt;&gt;&gt; c1.open()</span>
<span class="sd">        &gt;&gt;&gt; print(c1.getopsys())</span>
<span class="sd">        Database 10025 is active, V8.3.1 arc=4, opsys=Mainframe (IBM/Siemens/Fujitsu),</span>
<span class="sd">            cluster nucid 54321, High-order-byte-first/EBCDIC/IBM-float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opsysDict</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Mainframe (IBM/Siemens/Fujitsu)&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;VMS&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span>
            <span class="s2">&quot;Unix, Windows&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;Entire System Server&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opsys</span> <span class="ow">in</span> <span class="n">opsysDict</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">opsysDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">opsys</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">opsys</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opsys</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Database </span><span class="si">%5d</span><span class="s1"> is active, V</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">, arc=</span><span class="si">%d</span><span class="s1">,&#39;</span>\
              <span class="s1">&#39; opsys=</span><span class="si">%s</span><span class="s1">, cluster nucid </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>\
              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">dbid</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">smlevel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ptlevel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dbarchit</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Entire System </span><span class="si">%d</span><span class="s1"> is active, V</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">, arc=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>\
              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">dbid</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">smlevel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ptlevel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dbarchit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Adabas.printopsys"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.printopsys">[docs]</a>    <span class="k">def</span> <span class="nf">printopsys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print Opsys and Adabas Version</span>
<span class="sd">           Adabas open() call must have been done before</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getopsys</span><span class="p">())</span></div>

<div class="viewcode-block" id="Adabas.rc"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.rc">[docs]</a>    <span class="k">def</span> <span class="nf">rc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Release Command ID as specified in Adabas Control Block CID field</span>

<span class="sd">        :param cid: optional parameter specifies the command id</span>
<span class="sd">            to be used for the RC</span>

<span class="sd">        :var self.cb.dbid: must be set before calling this function</span>

<span class="sd">        Note: Currently not specific to any resource (ISN List, sequence or format)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cid</span><span class="o">=</span><span class="n">cid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;RC&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>

<div class="viewcode-block" id="Adabas.readByIsn"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.readByIsn">[docs]</a>    <span class="k">def</span> <span class="nf">readByIsn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">getnext</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read Sequential by ISN</span>
<span class="sd">        getnext = 1 if getnext else 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">getnext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># next ISN</span>
            <span class="c1"># print( &quot;readByISN() next ISN: %d&quot; % self.isn)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;RC&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


<div class="viewcode-block" id="Adabas.readisnseq"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.readisnseq">[docs]</a>    <span class="k">def</span> <span class="nf">readisnseq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read in ascending ISN sequence generator (experimental)</span>

<span class="sd">        if hold is true:</span>
<span class="sd">            put record in hold (L4)</span>
<span class="sd">        if wait is true:</span>
<span class="sd">            wait if record is in hold</span>

<span class="sd">        if dmap set to a datamap and multifetch is set to &gt; 1  in</span>
<span class="sd">        the Adabas class function returns the record</span>
<span class="sd">        that is located in the datamap buffer at the offset</span>

<span class="sd">        yields tuple (ISN, dmap)</span>

<span class="sd">        Example with multifetch:</span>

<span class="sd">        &gt;&gt;&gt; for isn, xemp in c.readisnseq(dmap=emp):</span>
<span class="sd">        ...    xemp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#o check for dmap != None ???</span>
        <span class="k">if</span> <span class="n">dmap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#self.cb.cmd=&#39;RC&#39;</span>
        <span class="c1">#self.cb.op1=&#39; &#39;</span>
        <span class="c1">#self.cb.op2=&#39; &#39;</span>
        <span class="c1">#self.call()</span>

        <span class="c1"># preserve for repeating calls</span>
        <span class="c1"># ad3 = self.cb.ad3</span>
        <span class="n">ad4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>                       <span class="c1"># multifetch</span>
            <span class="c1"># if self.mfgen==None:             # first call</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;M&#39;</span>
            <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;O&#39;</span>      <span class="c1"># M+R combined</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>

            <span class="n">mfgen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multifetch</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">isn</span><span class="p">,</span> <span class="n">rlen</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">mfgen</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span> <span class="c1">#emp</span>
                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span> <span class="c1"># emp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">+=</span><span class="mi">1</span>   <span class="c1"># next ISN</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad3</span><span class="o">=</span><span class="n">ad3</span>  <span class="c1"># restore for next call</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="n">ad4</span>
                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DataEnd -&gt; StopIteration&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">StopIteration</span></div>
                    <span class="c1"># break</span>

<div class="viewcode-block" id="Adabas.readphys"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.readphys">[docs]</a>    <span class="k">def</span> <span class="nf">readphys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in physical sequence generator (tested ok)</span>

<span class="sd">        :param hold: put record in hold (L5) if *hold* is true</span>
<span class="sd">        :param wait: if *wait* is true: wait if record is in hold</span>
<span class="sd">        :param dmap: Datamap object</span>
<span class="sd">        :return: datamap object if *dmap* set to a Datamap and</span>
<span class="sd">          multifetch is set to &gt; 1 in the Adabas class.</span>
<span class="sd">          The function returns the Datamap object</span>
<span class="sd">          that is located in the datamap buffer at the offset.</span>
<span class="sd">          It can be printed with .lprint() (line) or .dprint() (detail)</span>

<span class="sd">        Example with multifetch:</span>

<span class="sd">        &gt;&gt;&gt; for xemp in c.readphys(dmap=emp):</span>
<span class="sd">        ...    xemp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#o check for dmap != None ???</span>
        <span class="k">if</span> <span class="n">dmap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># print( &#39;readphys() init generator&#39;)</span>

        <span class="c1"># preserve for repeating calls</span>
        <span class="c1"># ad3 = self.cb.ad3</span>
        <span class="n">ad4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cidn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#  self.nextcid()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>                         <span class="c1"># multifetch</span>
            <span class="c1"># if self.mfgen==None:             # first call</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;M&#39;</span>
            <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L5&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;O&#39;</span>      <span class="c1"># M+R combined</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span>

            <span class="n">mfgen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multifetch</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">isn</span><span class="p">,</span> <span class="n">rlen</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">mfgen</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span>
                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># returns with StopIteration</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L5&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span>
                    <span class="c1"># self.cb.ad3=ad3  # restore for next call</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="n">ad4</span>
                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># returns with StopIteration</span></div>



<div class="viewcode-block" id="Adabas.readphysical"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.readphysical">[docs]</a>    <span class="k">def</span> <span class="nf">readphysical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read physical</span>

<span class="sd">        if hold is true:</span>
<span class="sd">            put record in hold (L4)</span>
<span class="sd">        if wait is true:</span>
<span class="sd">            wait if record is in hold</span>

<span class="sd">        if dmap set to a datamap and multifetch is set to &gt; 1  in</span>
<span class="sd">        the Adabas class readphysical() returns the size of the record</span>
<span class="sd">        that is located in the datamap buffer at the offset</span>

<span class="sd">        Example with multifetch:</span>

<span class="sd">        &gt;&gt;&gt; while c.readphysical(dmap=emp):</span>
<span class="sd">        ...    emp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dmap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">dmap</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># multifetch</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>             <span class="c1"># first call</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;M&#39;</span>
                <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L5&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;O&#39;</span>      <span class="c1"># M+R combined</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multifetch</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L5&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="mi">1</span> <span class="c1"># no rbl with ACBX # self.cb.rbl  # rbl is &gt; 0</span></div>


<div class="viewcode-block" id="Adabas.read"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">startisn</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in sequence generator</span>

<span class="sd">        :param seq: read sequence</span>
<span class="sd">            * physical (default) or</span>
<span class="sd">            * by descriptor (e.g. seq=&#39;AA&#39;</span>
<span class="sd">            * by ISN (seq=&#39;ISN&#39; or seq=&#39;I&#39;)</span>
<span class="sd">            * get next (seq=&#39;NEXT&#39; or seq=&#39;N&#39;)</span>
<span class="sd">        :param descending: read descending if true</span>
<span class="sd">            (only with seq=&#39;descriptor&#39; sequence)</span>
<span class="sd">        :param hold: put record in hold if *hold* is true</span>
<span class="sd">        :param wait: if *wait* is true: wait if record is in hold</span>
<span class="sd">        :param dmap: Datamap object</span>

<span class="sd">        :return: datamap object if *dmap* set to a Datamap and</span>
<span class="sd">          multifetch is set to &gt; 1 in the Adabas class.</span>
<span class="sd">          The function returns the Datamap object</span>
<span class="sd">          that is located in the datamap buffer at the offset.</span>
<span class="sd">          It can be printed with .lprint() (line) or .dprint() (detail)</span>

<span class="sd">        Example with datamap:</span>

<span class="sd">        &gt;&gt;&gt; for isn, xemp in c.read(dmap=emp):</span>
<span class="sd">        ...    xemp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        Example without datamap:</span>

<span class="sd">        &gt;&gt;&gt; emp.buffer = c.rb</span>
<span class="sd">        &gt;&gt;&gt; for isn, _ in c.read(seq=&#39;ISN&#39;):</span>
<span class="sd">        ...     emp.lprint()</span>
<span class="sd">        12345678 John      W     Adkinson</span>
<span class="sd">        12345699 Peter     O     Smith</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dmap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span>
            <span class="n">dmap</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">seq</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cidn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span> <span class="o">=</span> <span class="n">startisn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>

        <span class="k">if</span> <span class="n">hold</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L6&#39;</span>
            <span class="k">elif</span> <span class="n">seq</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span>
            <span class="k">elif</span> <span class="n">seq</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L4&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;N&#39;</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># physical</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L5&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L3&#39;</span>
            <span class="k">elif</span> <span class="n">seq</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span>
            <span class="k">elif</span> <span class="n">seq</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L1&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;N&#39;</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># physical</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">seq</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">6</span>
            <span class="k">if</span> <span class="n">descending</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;D&#39;</span>   <span class="c1"># descending</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;A&#39;</span>   <span class="c1"># ascending</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">dmap</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># multifetch</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>             <span class="c1"># first call</span>
                <span class="k">if</span> <span class="n">hold</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;O&#39;</span>      <span class="c1"># M+R combined</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;M&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multifetch</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">isn</span><span class="p">,</span> <span class="n">rlen</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="p">)</span>
                    <span class="n">dmap</span><span class="o">.</span><span class="n">dmlen</span> <span class="o">=</span> <span class="n">rlen</span>
                    <span class="k">yield</span> <span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span>
                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># returns with StopIteration</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># no multifetch</span>
            <span class="k">if</span> <span class="n">hold</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wait</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>

            <span class="c1"># preserve for repeating calls</span>
            <span class="c1"># ad3 = self.cb.ad3</span>
            <span class="n">ad4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">dmap</span><span class="p">:</span>
                        <span class="n">dmap</span><span class="o">.</span><span class="n">dmlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ldec</span> <span class="c1"># decompr. reclen</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">dmap</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="mi">1</span>

                    <span class="c1"># self.cb.ad3=ad3  # restore for next call</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="n">ad4</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">+=</span><span class="mi">1</span>      <span class="c1"># step up ISN for next call</span>

                <span class="k">except</span> <span class="n">DataEnd</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># returns with StopIteration</span></div>


<div class="viewcode-block" id="Adabas.searchcrits"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.searchcrits">[docs]</a>    <span class="k">def</span> <span class="nf">searchcrits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">crit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        free text form search mapped to search and value buffer entries</span>

<span class="sd">        :param view:</span>
<span class="sd">               - instance of Datamap with search fields attributed with</span>
<span class="sd">                 fn=adabas_field_name</span>
<span class="sd">               - dict of Adabas shortname, length, format tuples</span>
<span class="sd">                 accessed by longname or</span>

<span class="sd">        :param crit: selection criteria string (tokens separated by blank)</span>
<span class="sd">               e.g. &quot; name = BELL and department = ADM1* &quot;</span>

<span class="sd">               Comparison operators: &lt; &gt; &lt;= &gt;= = != and Adabas equivalent LT etc.</span>
<span class="sd">               with from-to  written as field = ADKI* or  field FROM &#39;A&#39; TO &#39;B&#39;</span>

<span class="sd">               Connecting operators: AND OR and Adabas defined D, O, R, Y, N</span>

<span class="sd">               Currently no parenthesis: i.e. criteria evaluated from left to right</span>
<span class="sd">               execept the Y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coops</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AND&#39;</span><span class="p">:</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;OR&#39;</span><span class="p">:</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span><span class="s1">&#39;O&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="s1">&#39;Y&#39;</span><span class="p">}</span>
        <span class="n">ops</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span> <span class="s1">&#39;EQ&#39;</span><span class="p">,</span> <span class="s1">&#39;EQ&#39;</span><span class="p">:</span> <span class="s1">&#39;EQ&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">:</span> <span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="s1">&#39;NE&#39;</span><span class="p">:</span> <span class="s1">&#39;NE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="s1">&#39;LT&#39;</span><span class="p">,</span> <span class="s1">&#39;LT&#39;</span><span class="p">:</span> <span class="s1">&#39;LT&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span> <span class="s1">&#39;LE&#39;</span><span class="p">,</span> <span class="s1">&#39;LE&#39;</span><span class="p">:</span> <span class="s1">&#39;LE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="s1">&#39;GT&#39;</span><span class="p">,</span> <span class="s1">&#39;GT&#39;</span><span class="p">:</span> <span class="s1">&#39;GT&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span> <span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="s1">&#39;GE&#39;</span><span class="p">:</span> <span class="s1">&#39;GE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;FROM&#39;</span><span class="p">:</span><span class="s1">&#39;EQ&#39;</span><span class="p">,</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span><span class="s1">&#39;TO&#39;</span><span class="p">,</span> <span class="s1">&#39;THRU&#39;</span><span class="p">:</span> <span class="s1">&#39;TO&#39;</span><span class="p">}</span>
        <span class="n">op_inverse</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">LE</span><span class="o">=</span><span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="s1">&#39;EQ&#39;</span><span class="p">,</span> <span class="n">LT</span><span class="o">=</span><span class="s1">&#39;GT&#39;</span><span class="p">)</span> <span class="c1">#  1 &lt; b  --&gt;  b &gt; 1</span>

        <span class="n">cd</span> <span class="o">=</span> <span class="n">crit</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSearchString</span><span class="p">(</span><span class="s1">&#39;No search operator found: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">crit</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">cd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSearchString</span><span class="p">(</span><span class="s1">&#39;Invalid search operator found: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSearchString</span><span class="p">(</span><span class="s1">&#39;Missing search value: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">crit</span><span class="p">)</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;0&#39;</span><span class="o">&lt;=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="s1">&#39;9&#39;</span> <span class="ow">or</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span> <span class="c1"># from-to   0 &lt; salary &lt; 9</span>
                <span class="n">val1</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">op_inverse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidSearchString</span><span class="p">(</span>
                        <span class="s1">&#39;Missing TO operator or value in FROM-TO expression : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">crit</span><span class="p">)</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">val2</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">op2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">op2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidSearchString</span><span class="p">(</span><span class="s1">&#39;Invalid TO search operator found: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val1</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">op2</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># still more tokens?</span>
                    <span class="n">op2</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">op2</span> <span class="o">==</span> <span class="s1">&#39;TO&#39;</span><span class="p">:</span>
                        <span class="c1"># adamf does not allow in from/to other VOP than EQ</span>
                        <span class="n">d</span><span class="p">,</span> <span class="n">val2</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span><span class="n">Datamap</span><span class="p">):</span>
                <span class="n">fld</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">getfndef</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fld</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fld</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSearchString</span><span class="p">(</span><span class="s2">&quot;Missing Adabas field name for &#39;</span><span class="si">%s</span><span class="s2">&#39; in Datamap </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">view</span><span class="o">.</span><span class="n">dmname</span><span class="p">))</span>

            <span class="n">fn</span><span class="p">,</span> <span class="n">flen</span><span class="p">,</span> <span class="n">ffrm</span> <span class="o">=</span> <span class="n">fld</span>

            <span class="k">if</span> <span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">val1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">val1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="n">val1</span><span class="o">=</span><span class="n">val1</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">val2</span> <span class="ow">and</span> <span class="n">val2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">val2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">val2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="n">val2</span><span class="o">=</span><span class="n">val2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">searchfield</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">flen</span><span class="p">,</span><span class="n">val1</span><span class="p">,</span><span class="n">crit</span><span class="o">=</span><span class="n">op</span><span class="p">,</span><span class="n">ffrm</span><span class="o">=</span><span class="n">ffrm</span><span class="p">)</span>
            <span class="c1">#print( key, val1, flen, fn, op)</span>
            <span class="c1">#dump(self.sb)</span>
            <span class="c1">#dump(self.vb)</span>

            <span class="k">if</span> <span class="n">op2</span> <span class="ow">and</span> <span class="n">val2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;,S,&#39;</span><span class="p">)</span> <span class="c1"># S operator</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">searchfield</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">flen</span><span class="p">,</span><span class="n">val2</span><span class="p">,</span><span class="n">ffrm</span><span class="o">=</span><span class="n">ffrm</span><span class="p">)</span>
                <span class="c1">#print( key, val2, flen, fn, op2)</span>
                <span class="c1">#dump(self.sb)</span>
                <span class="c1">#dump(self.vb)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">coop</span> <span class="o">=</span> <span class="n">coops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="c1"># connecting operator</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="n">coop</span><span class="p">)</span> <span class="c1"># AND or OR with previous</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Adabas.searchfield"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.searchfield">[docs]</a>    <span class="k">def</span> <span class="nf">searchfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fieldname</span><span class="p">,</span><span class="n">fieldlen</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">crit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ffrm</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">first</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a search value into the value buffer</span>

<span class="sd">        If last character of value contains &#39;*&#39; a from-to search is created</span>

<span class="sd">        Supported are: string and unicode values (with even field length in bytes)::</span>

<span class="sd">            if the search criterion is TO, LT or LE:</span>
<span class="sd">                the value is expanded with &#39;\xff&#39; to fieldlen</span>
<span class="sd">                if crit == &#39;TO&#39;: crit = &#39;&#39;</span>
<span class="sd">            if the search criterion is other than EQ, set the input param</span>
<span class="sd">                crit to GE, GT, LE, LT or NE.</span>

<span class="sd">        :parm ffrm:     one of Adabas formats gets inserted to search buffer</span>
<span class="sd">                        if numeric format (A,P,F,B or G): the input integer value</span>
<span class="sd">                        is converted to appropriate Adabas value in value buffer</span>
<span class="sd">        :param first:   if true it is the first search criterion in the buffers.</span>
<span class="sd">                        Reposition search and value buffer to start positions</span>
<span class="sd">        :param last:    if true it is the last search criterion in the buffers</span>
<span class="sd">                        Terminate search buffer</span>

<span class="sd">        Note: Don&#39;t forget to terminate search buffer with &#39;.&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">first</span><span class="p">:</span>           <span class="c1"># first search criterion: reset search and value buffer position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">ffrm</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="c1"># Adabas Unpacked format?</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fpack</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ffrm</span><span class="p">,</span><span class="n">fieldlen</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span><span class="n">fieldlen</span><span class="p">,</span><span class="n">ffrm</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ffrm</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">):</span> <span class="c1"># other Adabas numeric format</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fpack</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ffrm</span><span class="p">,</span><span class="n">fieldlen</span><span class="p">))</span>  <span class="c1"># binary data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span><span class="n">fieldlen</span><span class="p">,</span><span class="n">ffrm</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">):</span>   <span class="c1"># unicode (UTF-16)</span>
            <span class="c1">#todo crit parameter eval</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="c1"># with wild card</span>
                <span class="n">ln</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ln</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">fieldlen</span><span class="p">:</span>
                    <span class="n">ln</span><span class="o">=</span><span class="n">fieldlen</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>   <span class="c1"># limit to standard field length -1</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">[:</span><span class="n">ln</span><span class="p">]</span>      <span class="c1"># chop off wild card</span>
                <span class="c1"># avoid rsp-55/1: adabas/os truncates blanks internally and compares</span>
                <span class="c1">#          u&#39;abc &#39; == u&#39;abc&#39; &lt; u&#39;abc\u0000&#39;</span>
                <span class="c1"># this is different to adabas/mf which does</span>
                <span class="c1">#          u&#39;abc\u0000&#39; &lt;  u&#39;abc&#39; == u&#39;abc &#39;</span>
                <span class="n">uu</span><span class="o">=</span><span class="n">value</span> <span class="c1"># +u&#39; &#39;</span>
                <span class="n">ut</span><span class="o">=</span><span class="n">value</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\uFA29</span><span class="s1">&#39;</span>  <span class="c1"># highest 2 byte value in ICU collation</span>
                                    <span class="c1"># FFFF is the highest UTF-16 value (w/o surrogates)</span>
                <span class="c1"># dump(s1(uu.encode(&#39;UNICODE_INTERNAL&#39;))+s1(ut.encode(&#39;UNICODE_INTERNAL&#39;)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s1</span><span class="p">(</span><span class="n">uu</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UNICODE_INTERNAL&#39;</span><span class="p">))</span>
                            <span class="o">+</span><span class="n">s1</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UNICODE_INTERNAL&#39;</span><span class="p">)))</span> <span class="c1"># utf_16 in native byteorder</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fieldname</span><span class="o">+</span><span class="s1">&#39;,0,S,&#39;</span><span class="o">+</span><span class="n">fieldname</span><span class="o">+</span><span class="s1">&#39;,0&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                    <span class="n">ln</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="o">&gt;</span><span class="n">fieldlen</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">ln</span><span class="o">=</span><span class="n">fieldlen</span><span class="o">//</span><span class="mi">2</span>
                    <span class="n">uu</span><span class="o">=</span><span class="n">value</span><span class="o">+</span><span class="p">(</span><span class="n">fieldlen</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="n">ln</span><span class="p">)</span><span class="o">*</span><span class="sa">u</span><span class="s1">&#39; &#39;</span>
                    <span class="c1"># print( ln,value,fieldlen,fieldname)</span>
                    <span class="c1"># dump(uu.encode(&#39;UNICODE_INTERNAL&#39;) )</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">uu</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UNICODE_INTERNAL&#39;</span><span class="p">)</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>   <span class="c1"># other encoding</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="sa">b</span><span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="c1"># with wild card</span>
                <span class="n">ln</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">ln</span><span class="o">&gt;</span><span class="n">fieldlen</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ln</span><span class="o">=</span><span class="n">fieldlen</span><span class="o">-</span><span class="mi">1</span>     <span class="c1"># limit to standard field length -1</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">[:</span><span class="n">ln</span><span class="p">]</span>      <span class="c1"># chop off wild card</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fieldlen</span><span class="o">-</span><span class="n">ln</span><span class="p">)</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">(</span><span class="n">fieldlen</span><span class="o">-</span><span class="n">ln</span><span class="p">)</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="c1"># self.sb.write_text(fieldname+&#39;,S,&#39;+fieldname)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fieldname</span> <span class="o">+</span> <span class="s1">&#39;,</span><span class="si">%d</span><span class="s1">,S,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fieldlen</span><span class="p">,</span><span class="n">fieldname</span><span class="p">,</span><span class="n">fieldlen</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">&lt;</span><span class="n">fieldlen</span> <span class="ow">and</span> <span class="n">crit</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;LE&#39;</span><span class="p">,</span><span class="s1">&#39;LT&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;TO&#39;</span><span class="p">):</span> <span class="c1"># with upper value</span>
                <span class="n">ln</span><span class="o">=</span><span class="n">fieldlen</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ln</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fieldname</span> <span class="o">+</span> <span class="s1">&#39;,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fieldlen</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;TO&#39;</span><span class="p">:</span> <span class="n">crit</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ln</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ln</span><span class="o">&gt;</span><span class="n">fieldlen</span><span class="p">:</span>
                    <span class="n">ln</span><span class="o">=</span><span class="n">fieldlen</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="n">ln</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">fieldlen</span><span class="o">-</span><span class="n">ln</span><span class="p">)</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fieldname</span> <span class="o">+</span> <span class="s1">&#39;,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fieldlen</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crit</span> <span class="ow">and</span> <span class="n">crit</span> <span class="o">!=</span> <span class="s1">&#39;EQ&#39;</span><span class="p">:</span> <span class="c1"># omit EQ (=default)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">crit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">last</span><span class="p">:</span>                <span class="c1"># terminate search buffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Adabas.sortisns"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.sortisns">[docs]</a>    <span class="k">def</span> <span class="nf">sortisns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">saveisn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="s1">&#39;ISN&#39;</span><span class="p">,</span><span class="n">cid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sort ISN list saved on WORK or given in ISN buffer</span>

<span class="sd">        :param cid: Command id of ISN list to be sorted. If cid is blank</span>
<span class="sd">                    the ISN list is taken from the ISN buffer</span>

<span class="sd">        :param descending: if the ISN list is to be sorted by desciptors</span>
<span class="sd">                           setting descending=1 will sort by descending values</span>
<span class="sd">                           otherwise it will be ascending</span>

<span class="sd">        :param saveisn: 1 saves ISNs on WORK for later processing under CID</span>

<span class="sd">        :param sort: &#39;FNF2F3&#39; may specify up to 3 descriptors by which the</span>
<span class="sd">                      selected records are sorted.</span>

<span class="sd">                     &#39;ISN&#39; sorts the ISNs in ISN sequence (default)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;S9&#39;</span>
        <span class="k">if</span> <span class="n">descending</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;D&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="n">saveisn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;I&#39;</span> <span class="c1"># release ISN list for CID given in cb.cid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">sort</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span></div>


<div class="viewcode-block" id="Adabas.store"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fastde</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Store record into Adabas file</span>

<span class="sd">        :param isn: ISN if record to be stored under that ISN</span>
<span class="sd">                    otherwise let Adabas assign ISN</span>
<span class="sd">        :param fastde: field name of descriptor that will be stored</span>
<span class="sd">                    in ascending sequence. When specified the</span>
<span class="sd">                    normal index blocks will be fully filled rather than</span>
<span class="sd">                    half full due to not splitting the last block. This</span>
<span class="sd">                    can half the number of new normal index blocks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>

        <span class="k">if</span> <span class="n">isn</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;N2&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;N1&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="mi">0</span>   <span class="c1"># Adabas assigns ISN</span>

        <span class="k">if</span> <span class="n">fastde</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;F&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">fastde</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">+=</span> <span class="mi">1</span>   <span class="c1"># count updates</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span></div>


<div class="viewcode-block" id="Adabas.update"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update record</span>
<span class="sd">            hold==1 put record into hold status before update</span>
<span class="sd">            wait_on_hold==0 return with RSP145 - ISN hold by other user</span>
<span class="sd">            isn = record to update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;A1&#39;</span>

        <span class="k">if</span> <span class="n">hold</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>
            <span class="k">if</span> <span class="n">wait</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="n">isn</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">+=</span> <span class="mi">1</span>    <span class="c1"># count number of updates</span></div>



<div class="viewcode-block" id="Adabas.delete"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabas.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete record</span>
<span class="sd">            if wait is true: wait if record is in hold</span>
<span class="sd">            wait==0 return with RSP145 - ISN hold by other user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;E1&#39;</span>
        <span class="k">if</span> <span class="n">isn</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isn</span><span class="o">=</span><span class="n">isn</span>
        <span class="k">if</span> <span class="n">wait</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39;R&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">+=</span> <span class="mi">1</span>    <span class="c1"># count number of updates</span></div></div>


<span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="Adabasx"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabasx">[docs]</a><span class="k">class</span> <span class="nc">Adabasx</span><span class="p">(</span><span class="n">Adabas</span><span class="p">):</span>
    <span class="s2">&quot;Set of Adabas classes to issue Adabas calls and write/read related buffers&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ibl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">pbl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pmutex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ubl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thread</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">multifetch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">archit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cipher</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">totalCalls</span>
        <span class="n">gg</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;totalCalls&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">:</span> <span class="n">totalCalls</span><span class="o">=</span><span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub1</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub2</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cidseq</span><span class="o">=</span><span class="mi">0</span>               <span class="c1"># automatic cid count (should be user related</span>
                                    <span class="c1"># OR use cidn=-1 for automatic assignment in Adabas as in read()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span><span class="o">=</span><span class="n">cipher</span>          <span class="c1"># cipher code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_responses</span><span class="o">=</span><span class="p">[]</span>  <span class="c1"># list of response/subcode tuples consumed on each call()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># reset number of updates (should be user session related)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span> <span class="o">=</span> <span class="n">pmutex</span> <span class="k">if</span> <span class="n">pmutex</span> <span class="k">else</span> <span class="n">defs</span><span class="o">.</span><span class="n">dummymutex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span> <span class="o">=</span> <span class="n">archit</span>        <span class="c1"># architecture of adabas buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;latin1&#39;</span>     <span class="c1"># default buffer encoding unless architecture is EBCDIC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bo</span> <span class="o">=</span> <span class="n">NATIVEBO</span>

        <span class="k">if</span> <span class="n">archit</span> <span class="ow">and</span> <span class="p">(</span><span class="n">archit</span> <span class="o">&amp;</span> <span class="n">RDAAEBC</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">archit</span> <span class="o">&amp;</span> <span class="n">RDAABSW</span><span class="p">):</span>
            <span class="c1"># mainframe native calls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bo</span> <span class="o">=</span> <span class="n">NETWORKBO</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;cp037&#39;</span> <span class="c1"># EBCDIC US (Latin1 characterset)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span> <span class="o">=</span> <span class="n">RDAAEBC</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">archit</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;zos&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;cp037&#39;</span> <span class="c1"># EBCDIC US (Latin1 characterset)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span> <span class="o">=</span> <span class="n">RDAAEBC</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="o">=</span><span class="n">Abuf</span><span class="p">(</span><span class="n">ACBXLEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">=</span><span class="n">Acbx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># empty list of ABDs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># corresponding list of buffers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rdaarch</span><span class="o">=</span><span class="n">archit</span> <span class="c1"># architecture of adabas buffers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ver</span><span class="o">=</span><span class="n">ACBXV2</span> <span class="c1"># ACBX Version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">len</span><span class="o">=</span><span class="n">ACBXLEN</span>

        <span class="k">if</span> <span class="n">fbl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fbabd</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fb</span>    <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">fbl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fabd</span>  <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fbabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fabd</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">ABDXL</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">ver</span>     <span class="o">=</span> <span class="n">ABDXV2</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">ABDXF</span>   <span class="c1"># format buffer type</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">loc</span>     <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">fbl</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">send</span>    <span class="o">=</span> <span class="n">fbl</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">addr</span>    <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fbabd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rbl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rbabd</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rb</span>    <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">rbl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rabd</span>  <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rbabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rabd</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">ABDXL</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">ver</span>     <span class="o">=</span> <span class="n">ABDXV2</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">ABDXR</span>   <span class="c1"># format buffer type</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">loc</span>     <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">rbl</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">addr</span>    <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rbabd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sbl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbabd</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sb</span>    <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">sbl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sabd</span>  <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sbabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sabd</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">len</span>    <span class="o">=</span> <span class="n">ABDXL</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">ver</span>    <span class="o">=</span> <span class="n">ABDXV2</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">id</span>     <span class="o">=</span> <span class="n">ABDXS</span>   <span class="c1"># search buffer type</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">loc</span>    <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">size</span>   <span class="o">=</span> <span class="n">sbl</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">send</span>   <span class="o">=</span> <span class="n">sbl</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">addr</span>   <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbabd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vbl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vbabd</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vb</span>    <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">vbl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vabd</span>  <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vbabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="n">vd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vabd</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">ABDXL</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">ver</span>     <span class="o">=</span> <span class="n">ABDXV2</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">ABDXV</span>   <span class="c1"># value buffer type</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">loc</span>     <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">vbl</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">send</span>    <span class="o">=</span> <span class="n">vbl</span>
            <span class="n">vd</span><span class="o">.</span><span class="n">addr</span>    <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vbabd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ibl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ibabd</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ib</span>    <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ibl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iabd</span>  <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ibabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iabd</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">ABDXL</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">ver</span>     <span class="o">=</span> <span class="n">ABDXV2</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">ABDXI</span>   <span class="c1"># ISN buffer type</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">loc</span>     <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">ibl</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">send</span>    <span class="o">=</span> <span class="n">ibl</span>
            <span class="n">ia</span><span class="o">.</span><span class="n">addr</span>    <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibabd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mbl</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mbabd</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mb</span>    <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">mbl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mabd</span>  <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mbabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mabd</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">ABDXL</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">ver</span>     <span class="o">=</span> <span class="n">ABDXV2</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">ABDXM</span>   <span class="c1"># Multifetch buffer type</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">loc</span>     <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">mbl</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">send</span>    <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ma</span><span class="o">.</span><span class="n">addr</span>    <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbabd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mb</span><span class="p">)</span>


            <span class="c1">#self.ib=Abuf(ABDXL+ibl)    ## ABC+ib in one buffer not used</span>
            <span class="c1">#id=Acbx(buffer=self.ib)</span>
            <span class="c1">#id.len  = ABDXL</span>
            <span class="c1">#id.ver  = ABDXV2</span>
            <span class="c1">#id.id   = ABDXI   # ISN buffer type</span>
            <span class="c1">#id.loc  = ABDXSTD # direct</span>
            <span class="c1">#id.size = ibl</span>
            <span class="c1">#self.abds.append(ctypes.cast(self.ib, ctypes.c_char_p))</span>
            <span class="c1">#self.bufs.append(self.ib)</span>

        <span class="c1"># Create ABD array for later Adabasx call</span>
        <span class="c1"># This array may be zero in length if no ABDs exist</span>

        <span class="n">pclass</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abda</span> <span class="o">=</span> <span class="n">pclass</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">abd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abda</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">abd</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abdalen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abda</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">pbl</span><span class="o">==</span><span class="n">ubl</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span>\
            <span class="sd">&quot;&quot;&quot;Allocation of PB or UB buffers not yet implemented</span>
<span class="sd">               on instance creation: use addbuffer()&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mfgen</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># generator set if multifetch</span>

        <span class="k">if</span> <span class="n">multifetch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">=</span><span class="n">multifetch</span>  <span class="c1"># number of records to fetch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfele</span><span class="o">=</span><span class="n">Mfele</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfhdr</span><span class="o">=</span><span class="n">Mfhdr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mfc</span><span class="o">=</span><span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setadaid</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

<div class="viewcode-block" id="Adabasx.addbuffer"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabasx.addbuffer">[docs]</a>    <span class="k">def</span> <span class="nf">addbuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">buffer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create ABD for buffer and add abd and buffer of &lt;type&gt; to list of bufs and abds</span>
<span class="sd">            :param type:  buffer type is one of (&#39;F&#39;,&#39;R&#39;,&#39;M&#39;,&#39;S&#39;,&#39;V&#39;,&#39;I&#39;,&#39;P&#39;,&#39;U&#39;)</span>
<span class="sd">            :param size:  if size &gt; 0: reallocate buffer</span>
<span class="sd">            :returns abd: related ABD for further reference</span>
<span class="sd">            :raises ProgrammingError: when invalid buffer type given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;FRMSVIPU&#39;</span><span class="p">):</span> <span class="c1"># format, record etc buffer</span>
            <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span>
                <span class="s1">&#39;Invalid Adabas buffer type </span><span class="si">%s</span><span class="s1">. Should be one of &quot;FRMSVIPU&quot;&#39;</span>
                <span class="o">%</span> <span class="nb">type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">buffer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

        <span class="n">addabd</span>      <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">ABDXL</span><span class="p">)</span>
        <span class="n">abd</span>         <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="n">addabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
        <span class="n">abd</span><span class="o">.</span><span class="n">len</span>     <span class="o">=</span> <span class="n">ABDXL</span>
        <span class="n">abd</span><span class="o">.</span><span class="n">ver</span>     <span class="o">=</span> <span class="n">ABDXV2</span>
        <span class="n">abd</span><span class="o">.</span><span class="n">id</span>      <span class="o">=</span> <span class="nb">type</span>   <span class="c1"># format buffer type</span>
        <span class="n">abd</span><span class="o">.</span><span class="n">loc</span>     <span class="o">=</span> <span class="n">ABDXIND</span> <span class="c1"># indirect</span>
        <span class="n">abd</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">size</span>
        <span class="n">abd</span><span class="o">.</span><span class="n">addr</span>    <span class="o">=</span> <span class="n">addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addabd</span><span class="p">)</span> <span class="c1"># ctypes.cast(addabd, ctypes.c_char_p))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

        <span class="c1"># Update ABD array for later Adabasx call</span>
        <span class="n">pclass</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abda</span> <span class="o">=</span> <span class="n">pclass</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">abdi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abda</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">abdi</span><span class="p">,</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abdalen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abda</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="n">addabd</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span> <span class="c1"># abd was cast to Cbuf</span></div>


<div class="viewcode-block" id="Adabasx.newbuffer"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabasx.newbuffer">[docs]</a>    <span class="k">def</span> <span class="nf">newbuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resize existing buffer &lt;type&gt; if smaller</span>
<span class="sd">            :param type:  is one of (&#39;F&#39;,&#39;R&#39;,&#39;M&#39;,&#39;S&#39;,&#39;V&#39;,&#39;I&#39;,&#39;P&#39;,&#39;U&#39;)</span>
<span class="sd">            :param size:  if size &gt; 0: reallocate buffer</span>
<span class="sd">            :returns abd: related ABD for further reference</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">abdbuf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">):</span>
            <span class="n">abd</span> <span class="o">=</span> <span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="n">abdbuf</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">abd</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="n">Abuf</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fb</span> <span class="o">=</span> <span class="n">buf</span>  <span class="c1"># send size</span>
                    <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="o">=</span><span class="n">size</span>
                <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rb</span> <span class="o">=</span> <span class="n">buf</span>
                <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sb</span> <span class="o">=</span> <span class="n">buf</span>
                    <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="o">=</span><span class="n">size</span>  <span class="c1"># send size</span>
                <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vb</span> <span class="o">=</span> <span class="n">buf</span>
                    <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="o">=</span><span class="n">size</span>  <span class="c1"># send size</span>
                <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ib</span> <span class="o">=</span> <span class="n">buf</span>
                <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mb</span> <span class="o">=</span> <span class="n">buf</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Invalid Adabas call buffer type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

                <span class="n">abd</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>     <span class="c1"># set new size</span>
                <span class="n">abd</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">addressof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># set new buffer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span>  <span class="c1"># update list of buffers</span>
                <span class="k">return</span> <span class="n">abd</span>
        <span class="k">raise</span> <span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;Adabas call buffer type </span><span class="si">%s</span><span class="s2"> must exist&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span></div>



<div class="viewcode-block" id="Adabasx.call"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabasx.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">cbfields</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; issue Call Adabas with the Adabas control block class variables</span>

<span class="sd">        :param cbfields: list of key value pairs that can be used to</span>
<span class="sd">                         set the control block before the call</span>

<span class="sd">        &gt;&gt;&gt; c1.call(cmd=&#39;L1&#39;, cid=&#39;ABCD&#39;, fnr=11, isn=12345)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">totalCalls</span>

        <span class="n">cb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cbfields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="mh">0x04</span><span class="p">:</span> <span class="c1"># physical call</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">cb</span><span class="o">.</span><span class="n">nid</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">nid</span>            <span class="c1"># remember nucid if not yet done</span>
            <span class="c1"># cb.pdbid=cb.dbid</span>
            <span class="c1"># cb.pnucid=self.nucid</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;AELNS&#39;</span><span class="p">):</span> <span class="c1"># set pwd for read and upd commands</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ad3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cipher</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;AELNS&#39;</span><span class="p">):</span> <span class="c1"># set cipher code for read and upd commands</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ad4</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cipher</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">lnk_set_adabas_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aidb</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGBEFORE</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
                <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Before Adabasx call&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="p">(</span><span class="n">LOGCB</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">showCB</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="p">,</span> <span class="s1">&#39;Control Block Extended &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="p">),</span> <span class="s1">&#39;CB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">LOGCB</span><span class="o">|</span><span class="n">LOGBEFORE</span><span class="p">):</span> <span class="c1"># any buffer logging at all?</span>
                    <span class="n">jf</span><span class="o">=</span><span class="n">jr</span><span class="o">=</span><span class="n">jm</span><span class="o">=</span><span class="n">js</span><span class="o">=</span><span class="n">jv</span><span class="o">=</span><span class="n">ji</span><span class="o">=</span><span class="n">jp</span><span class="o">=</span><span class="n">ju</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">lopt</span> <span class="o">=</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">LOGCB</span><span class="o">|</span><span class="n">LOGBEFORE</span><span class="o">|</span><span class="n">LOGBUF</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="n">LOGBUF</span><span class="p">:</span>
                        <span class="n">bf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cmdbufs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">lopt</span> <span class="o">|=</span> <span class="n">bf</span>  <span class="c1"># OR any direct log request with eligible buffers depending on command</span>

                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">abdb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">):</span>
                        <span class="c1"># dump(abdb)</span>
                        <span class="n">abd</span><span class="o">=</span><span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="n">abdb</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGFB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;F&#39;</span><span class="p">:</span>
                            <span class="n">jf</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;FB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;FD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jf</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Format Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jf</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;FB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jf</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGRB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;R&#39;</span><span class="p">:</span>
                            <span class="n">jr</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;RB</span><span class="si">%d</span><span class="s1"> ABD&#39;</span><span class="o">%</span><span class="n">jr</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;RD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jr</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Record Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jr</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;RB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jr</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGMB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;M&#39;</span><span class="p">:</span>
                            <span class="n">jm</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;MB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;MD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jm</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Multifetch Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jm</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;MB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jm</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGSB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
                            <span class="n">js</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;SB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;SD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">js</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Search Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">js</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;SB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">js</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGVB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;V&#39;</span><span class="p">:</span>
                            <span class="n">jv</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;VB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;VD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jv</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Value Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;VB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jv</span>
                                <span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGIB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span>
                            <span class="n">ji</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;IB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;ID</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">ji</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;ISN Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">ji</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;IB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jf</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGPB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;P&#39;</span><span class="p">:</span>
                            <span class="n">jp</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;PB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;PD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jp</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Performance Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jp</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;PB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jp</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGUB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;U&#39;</span><span class="p">:</span>
                            <span class="n">ju</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="n">abdb</span><span class="p">,</span> <span class="s1">&#39;UB ABD&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">abdb</span><span class="p">),</span> <span class="s1">&#39;UD</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">ju</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;User Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">ju</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;FB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">ju</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>

        <span class="c1"># issue call</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">adalink</span><span class="o">.</span><span class="n">adabasx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abdalen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abda</span><span class="p">)</span>

        <span class="n">totalCalls</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InterfaceError</span><span class="p">(</span><span class="s1">&#39;Adabas call interface returned: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGCMD</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGRSP</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">64</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;CL&#39;</span><span class="p">)):</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
                <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;After Adabasx call&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showCB</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="n">LOGCB</span><span class="p">:</span>
                    <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="p">,</span> <span class="s1">&#39;Control Block Extended &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acbx</span><span class="p">),</span> <span class="s1">&#39;CB&#39;</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">LOGCB</span><span class="o">|</span><span class="n">LOGBEFORE</span><span class="p">):</span> <span class="c1"># any buffer logging at all?</span>
                    <span class="n">jf</span><span class="o">=</span><span class="n">jr</span><span class="o">=</span><span class="n">jm</span><span class="o">=</span><span class="n">js</span><span class="o">=</span><span class="n">jv</span><span class="o">=</span><span class="n">ji</span><span class="o">=</span><span class="n">jp</span><span class="o">=</span><span class="n">ju</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">lopt</span> <span class="o">=</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">LOGCB</span><span class="o">|</span><span class="n">LOGBEFORE</span><span class="o">|</span><span class="n">LOGBUF</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="n">LOGBUF</span><span class="p">:</span>
                        <span class="n">bf</span><span class="p">,</span> <span class="n">bfa</span> <span class="o">=</span> <span class="n">cmdbufs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">lopt</span> <span class="o">|=</span> <span class="n">bfa</span>  <span class="c1"># OR any direct log request with eligible buffers depending on command</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span> <span class="o">&amp;</span> <span class="n">LOGBEFORE</span><span class="p">:</span>
                            <span class="n">lopt</span> <span class="o">|=</span> <span class="n">bf</span>     <span class="c1"># include buffers sent to Adabas</span>

                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">abdb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abds</span><span class="p">):</span>
                        <span class="n">abd</span><span class="o">=</span><span class="n">Abdx</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="n">abdb</span><span class="p">,</span> <span class="n">ebcdic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcdic</span><span class="p">,</span> <span class="n">byteOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bo</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGFB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;F&#39;</span><span class="p">:</span>
                            <span class="n">jf</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Format Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jf</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span> <span class="p">),</span> <span class="s1">&#39;FB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jf</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGRB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;R&#39;</span><span class="p">:</span>
                            <span class="n">jr</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Record Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jr</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;RB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jr</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGMB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;M&#39;</span><span class="p">:</span>
                            <span class="n">jm</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Multifetch Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jm</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;MB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jm</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGSB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
                            <span class="n">js</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Search Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">js</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;SB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">js</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGVB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;V&#39;</span><span class="p">:</span>
                            <span class="n">jv</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Value Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;VB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jv</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGIB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span>
                            <span class="n">ji</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;ISN Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">ji</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;IB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jf</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGPB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;P&#39;</span><span class="p">:</span>
                            <span class="n">jp</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Performance Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">jp</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;PB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">jp</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lopt</span><span class="o">&amp;</span><span class="n">LOGUB</span> <span class="ow">and</span> <span class="n">abd</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="s1">&#39;U&#39;</span><span class="p">:</span>
                            <span class="n">ju</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;User Buffer </span><span class="si">%d</span><span class="s1"> - </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> - </span><span class="si">%08X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">ju</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">recv</span><span class="p">,</span> <span class="n">abd</span><span class="o">.</span><span class="n">addr</span><span class="p">),</span> <span class="s1">&#39;FB</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">ju</span><span class="p">,</span>
                                <span class="n">log</span><span class="o">=</span><span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_responses</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_responses</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">xrsp</span><span class="p">,</span><span class="n">xsub</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xrsp</span><span class="p">,</span> <span class="n">xsub</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># just a response code (with no subcode specified)</span>

            <span class="k">if</span> <span class="n">xsub</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1"># only response code specified</span>
                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGCMD</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
                        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Checking for expected response </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">xrsp</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">xrsp</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> \
                    <span class="s1">&#39;Unexpected response </span><span class="si">%d</span><span class="s1">, expected response </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> <span class="n">xrsp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">defs</span><span class="o">.</span><span class="n">logopt</span><span class="o">&amp;</span><span class="n">LOGCMD</span><span class="p">:</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmutex</span><span class="p">:</span>
                       <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Checking for expected response </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xrsp</span><span class="p">,</span><span class="n">xsub</span><span class="p">))</span>
                <span class="k">assert</span> <span class="n">xrsp</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="ow">and</span> <span class="n">xsub</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">errc</span><span class="p">,</span> \
                    <span class="s1">&#39;Unexpected response </span><span class="si">%d</span><span class="s1">/subcode </span><span class="si">%d</span><span class="s1">, expected response </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">errc</span><span class="p">,</span> <span class="n">xrsp</span><span class="p">,</span> <span class="n">xsub</span><span class="p">)</span>
            <span class="k">return</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># ignore DE truncation warning</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataEnd</span><span class="p">(</span><span class="s2">&quot;End of Data&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="n">adaerror</span><span class="o">.</span><span class="n">rsptext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span>
                        <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;=H&#39;</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">errbb</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">errc</span><span class="p">,</span>
                        <span class="n">cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">subcmd1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="p">,</span> <span class="n">subcmd2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="p">),</span>
                    <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Adabasx.showCB"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabasx.showCB">[docs]</a>    <span class="k">def</span> <span class="nf">showCB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print Adabas control block interpreted</span>

<span class="sd">        :param before: if not zero show CB fields relevant for before</span>
<span class="sd">                       the adabas call (e.g. no response code, cmd time)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cbx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span>
        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cmd=</span><span class="si">%s</span><span class="s1"> op1-8=</span><span class="si">%s</span><span class="s1"> dbid=</span><span class="si">%d</span><span class="s1"> fnr=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">op1_8</span><span class="p">),</span>  <span class="n">cbx</span><span class="o">.</span><span class="n">dbid</span><span class="p">,</span> <span class="n">cbx</span><span class="o">.</span><span class="n">fnr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cmd=</span><span class="si">%s</span><span class="s1"> op1-8=</span><span class="si">%s</span><span class="s1"> dbid=</span><span class="si">%d</span><span class="s1"> fnr=</span><span class="si">%d</span><span class="s1"> cmdt=</span><span class="si">%6.6f</span><span class="s1"> ms rsp=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">op1_8</span><span class="p">),</span>  <span class="n">cbx</span><span class="o">.</span><span class="n">dbid</span><span class="p">,</span> <span class="n">cbx</span><span class="o">.</span><span class="n">fnr</span><span class="p">,</span> <span class="n">cbx</span><span class="o">.</span><span class="n">cmdt</span><span class="o">/</span><span class="mf">4096000.</span><span class="p">,</span> <span class="n">cbx</span><span class="o">.</span><span class="n">rsp</span><span class="p">))</span>
        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cid=</span><span class="si">%s</span><span class="s1"> isn=</span><span class="si">%d</span><span class="s1"> isl=</span><span class="si">%d</span><span class="s1"> isq=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">cid</span><span class="p">),</span> <span class="n">cbx</span><span class="o">.</span><span class="n">isn</span><span class="p">,</span> <span class="n">cbx</span><span class="o">.</span><span class="n">isl</span><span class="p">,</span> <span class="n">cbx</span><span class="o">.</span><span class="n">isq</span><span class="p">))</span>
        <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;ad1=</span><span class="si">%s</span><span class="s1"> ad3=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">ad4=</span><span class="si">%s</span><span class="s1"> ad5=</span><span class="si">%s</span><span class="s1"> pid=</span><span class="si">%04X</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> \
          <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">ad1</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">ad3</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">ad4</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cbx</span><span class="o">.</span><span class="n">ad5</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaid</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">cbx</span><span class="o">.</span><span class="n">rsp</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
            <span class="n">respt</span> <span class="o">=</span> <span class="n">adaerror</span><span class="o">.</span><span class="n">rsptext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">rsp</span><span class="p">,</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;=H&#39;</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">errbb</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">errc</span><span class="p">,</span>
                <span class="n">cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">subcmd1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="p">,</span> <span class="n">subcmd2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="p">)</span>
            <span class="n">adalog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">respt</span><span class="p">)</span></div>
            <span class="c1"># adalog.debug(&#39;\tError info: fn=%s subc=%d buf=%s#%d offs=%d &#39; % (</span>
            <span class="c1">#    repr(cbx.errb), cbx.errc, cbx.errd, cbx.errf, cbx.erra))</span>


<div class="viewcode-block" id="Adabasx.open"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Adabasx.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tnaa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">etid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">arc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wcode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">wcharset</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a user session with a database.</span>

<span class="sd">        C{self.cb.dbid} must be set before calling this function</span>

<span class="sd">        :param acode: ECS code page number for client data encoding of A fields</span>

<span class="sd">        :param arc:   architecture key is the sum of the following values:</span>

<span class="sd">        - 1: low order byte first, 2 - EBCDIC,</span>
<span class="sd">        - 4: VAX</span>
<span class="sd">        - 8: IEEE floating-point;</span>
<span class="sd">        - defaults: high order byte first, ASCII, IBM 370 float</span>

<span class="sd">        if arc=0 will use data format native to caller&#39;s machine</span>

<span class="sd">        :param etid: 8 bytes Adabas transaction user id</span>
<span class="sd">        :param mode: defines share mode of files, default None</span>
<span class="sd">            (in the future: list of sublist of mode, file elements)</span>
<span class="sd">        :param tnaa: time of non-activity</span>
<span class="sd">        :param tt: transaction time</span>

<span class="sd">        :param tz:</span>
<span class="sd">            Timezone name according to the Olson Timezone DB / pytz</span>
<span class="sd">            e.g. &#39;Europe/Paris&#39;</span>

<span class="sd">        :param wcode: ECS code page number for client data encoding of W fields</span>

<span class="sd">        :param wcharset: IANA name for W field encoding (ADABAS OpenSystems V5.1,</span>
<span class="sd">            Mainframe only supports &#39;UTF-8&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;OP&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">=</span><span class="n">tnaa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">=</span><span class="n">tt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op1</span><span class="o">=</span><span class="s1">&#39; &#39;</span>         <span class="c1"># option R restrict files</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span> <span class="o">!=</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">op2</span><span class="o">=</span><span class="s1">&#39; &#39;</span>     <span class="c1"># leave option E read ET data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ad1</span><span class="o">=</span><span class="n">etid</span>
        <span class="n">_l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">open_modes</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># set open mode RB=UPD.</span>
        <span class="k">if</span> <span class="n">arc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ARC=&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">arc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">acode</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ACODE=&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">acode</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wcode</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;WCODE=&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">wcode</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">wcharset</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WCHARSET=&#39;&quot;</span><span class="o">+</span><span class="n">wcharset</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tz</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TZ=&#39;&quot;</span><span class="o">+</span><span class="n">tz</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="n">_rb</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_l</span><span class="p">)</span>  <span class="c1"># make string with parts separated by comma</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">rb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">_rb</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="c1">#if self.__class__.__name__==&#39;Adabasx&#39;:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rabd</span><span class="o">.</span><span class="n">send</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">_rb</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>    <span class="c1"># set send size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span> <span class="c1"># Adabas call</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updates</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># reset number of updates</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">&gt;&gt;</span><span class="mi">24</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">&gt;&gt;</span><span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">&gt;&gt;</span><span class="mi">8</span>  <span class="o">&amp;</span> <span class="mh">0xff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span>     <span class="o">&amp;</span> <span class="mh">0xff</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dbarchit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">&gt;&gt;</span><span class="mi">24</span>       <span class="c1">#</span>
                                              <span class="c1">#        0  1   2           4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opsys</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">&gt;&gt;</span><span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="c1"># opsys=(Mf,VMS,OpenSystems,NPR)</span>
                                              <span class="c1"># OpenSystems = Unix, Windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucid</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">&amp;</span> <span class="mh">0xffff</span>    <span class="c1"># nucid &gt; 0 if cluster nucleus</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isl</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># reset isl and isq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">isq</span><span class="o">=</span><span class="mi">0</span></div></div>


<div class="viewcode-block" id="space_calculation_AC"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.space_calculation_AC">[docs]</a><span class="k">def</span> <span class="nf">space_calculation_AC</span><span class="p">(</span> <span class="n">maxrec</span><span class="p">,</span> <span class="n">blocksize</span><span class="o">=</span><span class="mi">2544</span><span class="p">,</span> <span class="n">rabnsize</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate space requirements for an Adabas file in</span>
<span class="sd">    in the Address Converter.</span>

<span class="sd">    :param maxrec: number of records</span>
<span class="sd">    :param blocksize: ASSO blocksize and</span>
<span class="sd">    :param rabnsize: DATA storage RABN size defined for database (3 or 4)</span>

<span class="sd">    &gt;&gt;&gt; space_calculation_AC(5000,blocksize=2004)</span>
<span class="sd">    8</span>
<span class="sd">    &gt;&gt;&gt; space_calculation_AC(5000,blocksize=2004,rabnsize=4)</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; space_calculation_AC(10**9,rabnsize=4)</span>
<span class="sd">    1572328</span>
<span class="sd">    &gt;&gt;&gt; space_calculation_AC(10**9,rabnsize=3)</span>
<span class="sd">    1179246</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">isnsperblock</span> <span class="o">=</span> <span class="n">blocksize</span><span class="o">//</span><span class="n">rabnsize</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">maxrec</span><span class="o">+</span><span class="n">isnsperblock</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">isnsperblock</span></div>


<span class="c1"># Dict describing which buffers may be used for a given command</span>
<span class="c1"># LOGSP marks cases where it depends also on the command options</span>
<span class="n">cmdbufs</span><span class="o">=</span>\
    <span class="p">{</span>
    <span class="s2">&quot;A1&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;A4&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;A9&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>

    <span class="s2">&quot;BT&quot;</span><span class="p">:(</span> <span class="n">LOGSP</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;C1&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;C3&quot;</span><span class="p">:(</span> <span class="n">LOGSP</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;C5&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;CL&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;E1&quot;</span><span class="p">:(</span> <span class="n">LOGSP</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;E4&quot;</span><span class="p">:(</span> <span class="n">LOGSP</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;ET&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;HI&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>

    <span class="s2">&quot;L1&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;L2&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;L3&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;L4&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;L5&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;L6&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;L9&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>

    <span class="s2">&quot;LA&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;LF&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;MC&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;N1&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;N2&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;OP&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>

    <span class="s2">&quot;PC&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="p">,</span> <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;RC&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;RE&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;RI&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>

    <span class="s2">&quot;S1&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGIB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;S2&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGIB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;S4&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGIB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;S5&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGIB</span><span class="p">),</span>
    <span class="s2">&quot;S8&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGIB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;S9&quot;</span><span class="p">:(</span> <span class="n">LOGSP</span><span class="p">,</span>       <span class="n">LOGIB</span><span class="o">|</span><span class="n">LOGSP</span><span class="p">),</span>

    <span class="s2">&quot;SP&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="p">),</span>

    <span class="s2">&quot;U0&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;U1&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;U2&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;U3&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;V1&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">),</span>
    <span class="s2">&quot;V2&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">,</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">),</span>
    <span class="s2">&quot;V3&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">,</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">),</span>
    <span class="s2">&quot;V4&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="o">|</span><span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGSB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">,</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">),</span>

    <span class="s2">&quot;X0&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;X1&quot;</span><span class="p">:(</span> <span class="mi">0</span><span class="p">,</span>           <span class="n">LOGRB</span><span class="p">),</span>
    <span class="s2">&quot;X2&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;X3&quot;</span><span class="p">:(</span> <span class="n">LOGFB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="p">),</span>

    <span class="s2">&quot;YA&quot;</span><span class="p">:(</span> <span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGRB</span><span class="p">,</span> <span class="n">LOGSP</span><span class="p">),</span>
    <span class="s2">&quot;YB&quot;</span><span class="p">:(</span> <span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;YD&quot;</span><span class="p">:(</span> <span class="n">LOGVB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;YE&quot;</span><span class="p">:(</span> <span class="n">LOGVB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;YF&quot;</span><span class="p">:(</span> <span class="n">LOGRB</span><span class="o">|</span><span class="n">LOGVB</span><span class="o">|</span><span class="n">LOGIB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;YP&quot;</span><span class="p">:(</span> <span class="n">LOGVB</span><span class="p">,</span>       <span class="mi">0</span><span class="p">),</span>
    <span class="s2">&quot;YR&quot;</span><span class="p">:(</span> <span class="n">LOGVB</span><span class="p">,</span>       <span class="n">LOGRB</span><span class="p">),</span>
    <span class="p">}</span>


<span class="c1"># all fields of event info</span>
<span class="n">INFOFIELDS</span><span class="o">=</span><span class="p">(</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;etype&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;esubtype&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;dbid&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;nucid&#39;</span><span class="p">),</span>
    <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;fnr&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;subcode&#39;</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;isn&#39;</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;etime&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_STCK</span><span class="o">+</span><span class="n">T_GMT</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;affected_tid&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>  <span class="c1"># internal user id</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_jobname&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">Bytes</span><span class="p">(</span><span class="s1">&#39;affected_cpuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_vmid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;affected_process&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_userid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_etid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_secuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;holder_tid&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>  <span class="c1"># internal user id</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_jobname&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">Bytes</span><span class="p">(</span><span class="s1">&#39;holder_cpuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_vmid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;holder_process&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_userid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_etid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_secuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="p">)</span>
<span class="n">INFOFB</span> <span class="o">=</span> <span class="s1">&#39;AA,AB,AC,AD,AE,AF,AG,AH,AT,AQ,AI,AJ,AK,AL,AR,AM,AN,AO,AP.&#39;</span>
<span class="n">INFOFB82</span> <span class="o">=</span> <span class="s1">&#39;AA,AB,AC,AD,AE,AF,AG,AH,AT,AI,AJ,AK,AL,AM,AN,AO,AP.&#39;</span>

<span class="c1"># all fields of event info (Adabas V8.2)</span>
<span class="n">INFOFIELDS82</span><span class="o">=</span><span class="p">(</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;etype&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;esubtype&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;dbid&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;nucid&#39;</span><span class="p">),</span>
    <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;fnr&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;subcode&#39;</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;isn&#39;</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;etime&#39;</span><span class="p">,</span><span class="n">opt</span><span class="o">=</span><span class="n">T_STCK</span><span class="o">+</span><span class="n">T_GMT</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_jobname&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">Bytes</span><span class="p">(</span><span class="s1">&#39;affected_cpuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_vmid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;affected_process&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_userid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_etid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affected_secuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_jobname&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">Bytes</span><span class="p">(</span><span class="s1">&#39;holder_cpuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_vmid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;holder_process&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_userid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_etid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;holder_secuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="p">)</span>
<span class="n">INFOFB82</span> <span class="o">=</span> <span class="s1">&#39;AA,AB,AC,AD,AE,AF,AG,AH,AT,AI,AJ,AK,AL,AM,AN,AO,AP.&#39;</span>

<div class="viewcode-block" id="Infomap"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Infomap">[docs]</a><span class="k">class</span> <span class="nc">Infomap</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Infomap&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<span class="c1"># selection of information fields</span>
<span class="n">INFOFIELDS2</span><span class="o">=</span><span class="p">(</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;styp&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;dbid&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;nucid&#39;</span><span class="p">),</span>
    <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;fnr&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;resp&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;subc&#39;</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;isn&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;etime&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_STCK</span><span class="o">+</span><span class="n">T_GMT</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;afftid&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="c1">#Bytes(&#39;affcpuid&#39;,8, opt=T_HEX),</span>
    <span class="c1">#String(&#39;affvmid&#39;,8, opt=T_EBCDIC),</span>
    <span class="c1">#Uint4(&#39;affproc&#39;, opt=T_HEX,repos=16), # skip 16 bytes cpu/vmid</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">,</span><span class="n">repos</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affsecid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;hldtid&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">),</span>
    <span class="c1">#Bytes(&#39;hldcpuid&#39;,8, opt=T_HEX),</span>
    <span class="c1">#String(&#39;hldvmid&#39;,8, opt=T_EBCDIC),</span>
    <span class="c1">#Uint4(&#39;hldproc&#39;, opt=T_HEX, repos=16),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;hlduid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;hldsecid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="p">)</span>
<span class="n">INFOFB2</span> <span class="o">=</span> <span class="s1">&#39;AA,AB,AC,AD,AE,AF,AG,AH,AT,AQ,AJ,AL,AR,AN,AP.&#39;</span>
<span class="n">INFOFB282</span> <span class="o">=</span> <span class="s1">&#39;AA,AB,AC,AD,AE,AF,AG,AH,AT,AJ,AL,AN,AP.&#39;</span>
<span class="c1"># selection of info fields ADA82</span>
<span class="n">INFOFIELDS282</span><span class="o">=</span><span class="p">(</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;styp&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;dbid&#39;</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;nucid&#39;</span><span class="p">),</span>
    <span class="n">Int4</span><span class="p">(</span><span class="s1">&#39;fnr&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;resp&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">Uint2</span><span class="p">(</span><span class="s1">&#39;subc&#39;</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;isn&#39;</span><span class="p">,</span><span class="n">colsize</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
    <span class="n">Uint8</span><span class="p">(</span><span class="s1">&#39;etime&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_STCK</span><span class="o">+</span><span class="n">T_GMT</span><span class="p">),</span>
    <span class="c1">#Bytes(&#39;affcpuid&#39;,8, opt=T_HEX),</span>
    <span class="c1">#String(&#39;affvmid&#39;,8, opt=T_EBCDIC),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;affproc&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">,</span><span class="n">repos</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="c1"># skip 16 bytes cpu/vmid</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affuid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;affsecid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="c1">#Bytes(&#39;hldcpuid&#39;,8, opt=T_HEX),</span>
    <span class="c1">#String(&#39;hldvmid&#39;,8, opt=T_EBCDIC),</span>
    <span class="n">Uint4</span><span class="p">(</span><span class="s1">&#39;hldproc&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_HEX</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;hlduid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">T_EBCDIC</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">String</span><span class="p">(</span><span class="s1">&#39;hldsecid&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="Infomap2"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.Infomap2">[docs]</a><span class="k">class</span> <span class="nc">Infomap2</span><span class="p">(</span><span class="n">Datamap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Datamap</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Infomap2&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&#39;1,AA,2,B,FI&#39;     Event type    =X&#39;0001&#39; for now</span>
<span class="sd">&#39;1,AB,2,B,FI&#39;     Event sub type    =X&#39;0000&#39; for now</span>
<span class="sd">&#39;1,AC,2,B,FI&#39;     DBID</span>
<span class="sd">&#39;1,AD,2,B,FI&#39;     NUCID</span>
<span class="sd">&#39;1,AE,4,B,FI&#39;     File Number</span>
<span class="sd">&#39;1,AF,2,B,FI&#39;     Response Code =145 for now</span>
<span class="sd">&#39;1,AG,2,B,FI&#39;     Subcode   =X&#39;0000&#39; for now</span>
<span class="sd">&#39;1,AH,8,B,FI&#39;     ISN</span>
<span class="sd">&#39;1,AT,8,B,FI&#39;     Time of Event (STCK value)</span>
<span class="sd">&#39;1,AQ,4,B,FI&#39;     Internal user ID (TID) of affected user</span>
<span class="sd">&#39;1,AI,8,A,FI&#39;     Job Name of affected user</span>
<span class="sd">&#39;1,AJ,28,A,FI,NV&#39; User ID of affected user</span>
<span class="sd">&#39;1,AK,8,A,FI&#39;     ET ID of affected user V83</span>
<span class="sd">&#39;1,AL,8,A,FI&#39;     SECUID of affected user</span>
<span class="sd">&#39;1,AR,4,B,FI&#39;     Internal user ID (TID) of holding user</span>
<span class="sd">&#39;1,AM,8,A,FI&#39;     Job Name of the user holding the record</span>
<span class="sd">&#39;1,AN,28,A,FI,NV&#39; User ID of the user holding the record</span>
<span class="sd">&#39;1,AO,8,A,FI&#39;     ET ID of the user holding the record</span>
<span class="sd">&#39;1,AP,8,A,FI&#39;     SECUID of the user holding the record V83</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="eventinfo"><a class="viewcode-back" href="../../../modules.html#adapya.adabas.api.eventinfo">[docs]</a><span class="k">def</span> <span class="nf">eventinfo</span><span class="p">(</span><span class="n">dbid</span><span class="p">,</span> <span class="n">printinfo</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; return event information after response code</span>
<span class="sd">        initially only for response 145</span>

<span class="sd">        :param dbid: dbid</span>
<span class="sd">        :param printinfo: when set eventinfo will be printed</span>
<span class="sd">        :param detailed: when set and printinfo is set eventinfo</span>
<span class="sd">                         will be printed in detail</span>
<span class="sd">        :param version: &#39;8.2&#39; Adabas version 8.2 view</span>
<span class="sd">                        &#39;&#39; - latest version (default)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">c2</span><span class="o">=</span><span class="n">Adabasx</span><span class="p">(</span><span class="n">fbl</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">rbl</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">dbid</span><span class="o">=</span><span class="n">dbid</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">fnr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>    <span class="c1"># INFO buffer view</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">cidn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>   <span class="c1"># get CID</span>

        <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;8.2&#39;</span><span class="p">:</span>
            <span class="n">c2</span><span class="o">.</span><span class="n">fb</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">c2</span><span class="o">.</span><span class="n">fb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">INFOFB82</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">,</span><span class="n">fields2</span><span class="o">=</span><span class="n">INFOFIELDS82</span><span class="p">,</span><span class="n">INFOFIELDS282</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c2</span><span class="o">.</span><span class="n">fb</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">c2</span><span class="o">.</span><span class="n">fb</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">INFOFB</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">,</span><span class="n">fields2</span><span class="o">=</span><span class="n">INFOFIELDS</span><span class="p">,</span><span class="n">INFOFIELDS2</span>

        <span class="k">if</span> <span class="n">detailed</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">=</span><span class="n">Infomap</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">)</span>
            <span class="c1"># detailed view does not fit into line -&gt; no header print</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">=</span><span class="n">Infomap2</span><span class="p">(</span><span class="o">*</span><span class="n">fields2</span><span class="p">)</span>
            <span class="k">if</span>  <span class="n">printinfo</span><span class="p">:</span>
                <span class="n">ev</span><span class="o">.</span><span class="n">lprint</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># normal user has only one record</span>
        <span class="c1">#  and getnext returns rsp-22</span>

        <span class="c1">#while c2.readphysical(dmap=infomap2):  # normal user gets only last event</span>
        <span class="c1"># infomap2.lprint()</span>

        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">readphysical</span><span class="p">(</span><span class="n">dmap</span><span class="o">=</span><span class="n">ev</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">printinfo</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ev</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">detailed</span><span class="p">:</span>
                    <span class="n">ev</span><span class="o">.</span><span class="n">dprint</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ev</span><span class="o">.</span><span class="n">lprint</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error obtaining eventinfo&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">dump</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">apa</span><span class="o">.</span><span class="n">acb</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Control Block&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<span class="k">def</span> <span class="nf">refreshfile</span><span class="p">(</span><span class="n">dbid</span><span class="p">,</span> <span class="n">fnr</span><span class="p">):</span>
    <span class="n">rf</span><span class="o">=</span><span class="n">Adabas</span><span class="p">(</span><span class="n">rbl</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">rf</span><span class="o">.</span><span class="n">dbid</span><span class="o">=</span><span class="n">dbid</span>
    <span class="n">rf</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">fnr</span><span class="o">=</span><span class="n">fnr</span>
    <span class="n">rf</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>   <span class="c1"># isn=0 is refresh file</span>

<span class="c1">#  Copyright 2004-ThisYear Software AG</span>
<span class="c1">#</span>
<span class="c1">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1">#  you may not use this file except in compliance with the License.</span>
<span class="c1">#  You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1">#  See the License for the specific language governing permissions and</span>
<span class="c1">#  limitations under the License.</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2004-2019, software AG

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>